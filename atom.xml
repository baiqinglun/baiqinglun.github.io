<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>大白的个人博客</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2025-02-12T03:04:51.010Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>DB</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>zotero实现标注自动打标签</title>
    <link href="http://example.com/2025/02/12/044%20zotero%E5%AE%9E%E7%8E%B0%E6%A0%87%E6%B3%A8%E8%87%AA%E5%8A%A8%E6%89%93%E6%A0%87%E7%AD%BE/"/>
    <id>http://example.com/2025/02/12/044%20zotero%E5%AE%9E%E7%8E%B0%E6%A0%87%E6%B3%A8%E8%87%AA%E5%8A%A8%E6%89%93%E6%A0%87%E7%AD%BE/</id>
    <published>2025-02-12T02:54:00.000Z</published>
    <updated>2025-02-12T03:04:51.010Z</updated>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p>本文最新更新于 2025/02/12 上午</p>          </div><p>目的：根据标签定位到标注</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250212110313.png"></p></div><p>首先下载安装zotero软件以及<code>zotero-actions-tags</code>插件</p><p>设置插件，新建动作，新建注释时触发，并自定义脚本，粘贴下属代码</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250212105727.png"></p></div><p>代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 注释：根据注释颜色更新标签（移除旧标签并添加新标签）</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span> 通过注释颜色自动更新标签，包括移除旧标签并添加新标签</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> appwcn windingwind</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@link</span> https://github.com/windingwind/zotero-actions-tags/discussions/339</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">// 定义颜色与标签的映射（请更换成自己的颜色和标签）</span><br><span class="hljs-keyword">const</span> tags = &#123;<br>    <span class="hljs-string">&quot;#ffd400&quot;</span>: <span class="hljs-string">&quot;结论&quot;</span>,<br>    <span class="hljs-string">&quot;#0033ff&quot;</span>: <span class="hljs-string">&quot;摘录&quot;</span>,<br>    <span class="hljs-string">&quot;#ff4349&quot;</span>: <span class="hljs-string">&quot;原因&quot;</span><br>&#125;;<br><br><br><span class="hljs-keyword">const</span> allTags = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(tags);<br><br><br><span class="hljs-keyword">if</span> (!item) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No item provided.&quot;</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (!item.<span class="hljs-title function_">isAnnotation</span>() || !item.<span class="hljs-property">annotationColor</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;This item is not an annotation or has no color.&quot;</span>;<br>&#125;<br><br><br><span class="hljs-keyword">const</span> annotationColor = item.<span class="hljs-property">annotationColor</span>.<span class="hljs-title function_">toLowerCase</span>();<br><span class="hljs-keyword">const</span> newTag = tags[annotationColor];<br><br><br><span class="hljs-keyword">const</span> title = item.<span class="hljs-title function_">getField</span>(<span class="hljs-string">&#x27;title&#x27;</span>);<br><br><br><span class="hljs-keyword">const</span> existingTags = item.<span class="hljs-title function_">getTags</span>().<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">tag</span> =&gt;</span> tag.<span class="hljs-property">tag</span>); <br><span class="hljs-keyword">let</span> removedTags = [];<br><br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> tag <span class="hljs-keyword">of</span> existingTags) &#123;<br>    <span class="hljs-keyword">if</span> (allTags.<span class="hljs-title function_">includes</span>(tag)) &#123;<br>        item.<span class="hljs-title function_">removeTag</span>(tag);<br>        removedTags.<span class="hljs-title function_">push</span>(tag);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">if</span> (newTag) &#123;<br>    item.<span class="hljs-title function_">addTag</span>(newTag);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`Title: &quot;<span class="hljs-subst">$&#123;title&#125;</span>&quot; | Removed: [<span class="hljs-subst">$&#123;removedTags.join(<span class="hljs-string">&quot;, &quot;</span>)&#125;</span>] | Added: <span class="hljs-subst">$&#123;newTag&#125;</span>`</span>;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (removedTags.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`Title: &quot;<span class="hljs-subst">$&#123;title&#125;</span>&quot; | Removed: [<span class="hljs-subst">$&#123;removedTags.join(<span class="hljs-string">&quot;, &quot;</span>)&#125;</span>] | No new tag added.`</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`Title: &quot;<span class="hljs-subst">$&#123;title&#125;</span>&quot; | No matching tag for color: <span class="hljs-subst">$&#123;annotationColor&#125;</span>.`</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>根据自己的style更改颜色与标签的对应关系。</p><p><code>Shitf + P</code>打开style设置查看颜色对应关系，并复制到代码中</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250212110110.png"></p></div><p>效果</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250212110213.png"></p></div><div class="note note-success">            <p>完成</p>          </div>]]></content>
    
    
    <summary type="html">在标注时，根据标注的颜色自动打标签，方便查阅</summary>
    
    
    
    <category term="科研" scheme="http://example.com/categories/%E7%A7%91%E7%A0%94/"/>
    
    
    <category term="科研" scheme="http://example.com/tags/%E7%A7%91%E7%A0%94/"/>
    
    <category term="zotero" scheme="http://example.com/tags/zotero/"/>
    
  </entry>
  
  <entry>
    <title>科研配色</title>
    <link href="http://example.com/2025/02/12/043%20%E7%A7%91%E7%A0%94%E7%BB%98%E5%9B%BE/"/>
    <id>http://example.com/2025/02/12/043%20%E7%A7%91%E7%A0%94%E7%BB%98%E5%9B%BE/</id>
    <published>2025-02-12T00:39:00.000Z</published>
    <updated>2025-02-12T03:05:11.638Z</updated>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p>本文最新更新于 2025/02/12 上午</p>          </div><h2 id="绘图样式">绘图样式</h2><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250212083935.png"></p></div><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250212084458.png"></p></div>]]></content>
    
    
    <summary type="html">收集科研绘图模板，好看的配色，定期收集science插图</summary>
    
    
    
    <category term="科研" scheme="http://example.com/categories/%E7%A7%91%E7%A0%94/"/>
    
    
    <category term="科研" scheme="http://example.com/tags/%E7%A7%91%E7%A0%94/"/>
    
    <category term="绘图" scheme="http://example.com/tags/%E7%BB%98%E5%9B%BE/"/>
    
    <category term="配色" scheme="http://example.com/tags/%E9%85%8D%E8%89%B2/"/>
    
  </entry>
  
  <entry>
    <title>Abaqus模拟之裂纹扩展</title>
    <link href="http://example.com/2025/02/11/042%20Abaqus%E6%A8%A1%E6%8B%9F%E4%B9%8B%E8%A3%82%E7%BA%B9%E6%89%A9%E5%B1%95/"/>
    <id>http://example.com/2025/02/11/042%20Abaqus%E6%A8%A1%E6%8B%9F%E4%B9%8B%E8%A3%82%E7%BA%B9%E6%89%A9%E5%B1%95/</id>
    <published>2025-02-11T12:26:00.000Z</published>
    <updated>2025-02-12T03:05:27.158Z</updated>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p>本文最新更新于 2025/02/11 晚上</p>          </div><div class="note note-info">            <p>案例需求</p>          </div><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211203759.png"></p></div><h2 id="创建铁板">1、创建铁板</h2><p>在<code>Part</code>界面创建一个<code>40x40x5</code>的铁板。</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211203656.png"></p></div><h2 id="创建裂纹">2、创建裂纹</h2><p>需要将绘制一个<code>平面</code>嵌入到铁板中完成裂纹的创建</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211204047.png"></p></div><p>创建成功</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211204204.png"></p></div><h2 id="创建材料">3、创建材料</h2><ul><li>弹性<ul><li>杨氏模量：206000</li><li>泊松比：0.3</li></ul></li><li>塑性<ul><li>许用应力：1000</li><li>塑性应力：0</li></ul></li></ul><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211205424.png"></p></div><ul><li>损伤<ul><li>类型：Maxps【最大主应变】</li><li>最大主应变损伤250</li></ul></li></ul><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211205556.png"></p></div><ul><li>添加子选项：损伤演变<ul><li>破坏位移：0.01</li></ul></li></ul><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211205639.png"></p></div><h2 id="创建截面">4、创建截面</h2><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211210002.png"></p></div><p>赋予给part-1</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211210047.png"></p></div><h2 id="装配">5、装配</h2><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211210525.png"></p></div><h2 id="创建分析步">6、创建分析步</h2><p>打开几何非线性性更容易收敛</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211210758.png"></p></div><h2 id="相互作用">7、相互作用</h2><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211211137.png"></p></div><p>拾取位置</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211211243.png"></p></div><h2 id="场输出设置">8、场输出设置</h2><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211211521.png"></p></div><p>主要是勾选这两个</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211211853.png"></p></div><p>输出100次</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211212029.png"></p></div><h2 id="网格">9、网格</h2><p>只需要给铁板绘制网格即可，裂纹面不需要绘制。</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211212159.png"></p></div><p>划分网格</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211212306.png"></p></div><p>网格属性</p><ul><li>勾选沙漏控制</li><li>单元删除</li><li>指定最大下降</li></ul><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211212451.png"></p></div><h2 id="添加约束条件">10、添加约束条件</h2><p>底端固定</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211212725.png"></p></div><p>顶端向上拉120MPa</p><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211212915.png"></p></div><h2 id="创建作业并提交计算">11、创建作业并提交计算</h2><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211213244.png"></p></div><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250211215558.png"></p></div>]]></content>
    
    
    <summary type="html">钢管裂纹扩展的 XFEM 方法</summary>
    
    
    
    <category term="模拟" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="Abaqus" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/Abaqus/"/>
    
    <category term="案例" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/Abaqus/%E6%A1%88%E4%BE%8B/"/>
    
    
    <category term="模拟" scheme="http://example.com/tags/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="Abaqus" scheme="http://example.com/tags/Abaqus/"/>
    
    <category term="裂纹扩展" scheme="http://example.com/tags/%E8%A3%82%E7%BA%B9%E6%89%A9%E5%B1%95/"/>
    
  </entry>
  
  <entry>
    <title>文献写作词句</title>
    <link href="http://example.com/2025/02/11/041%20%E6%96%87%E7%8C%AE%E5%86%99%E4%BD%9C%E8%AF%8D%E5%8F%A5/"/>
    <id>http://example.com/2025/02/11/041%20%E6%96%87%E7%8C%AE%E5%86%99%E4%BD%9C%E8%AF%8D%E5%8F%A5/</id>
    <published>2025-02-11T00:29:00.000Z</published>
    <updated>2025-02-11T11:51:47.670Z</updated>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p>本文最新更新于 2025/02/11 上午</p>          </div><h2 id="section">2025-02-11</h2><div class="note note-info">            <p>原文： 【<strong>This knowledge plays a vital role in process andchemical safety as well as in fuel design</strong>】</p><p>翻译：<em>这些知识在工艺和化学安全以及燃料设计中起着至关重要的作用</em></p><p>写作建议：<span class="label label-primary">起着关键作用</span> <spanclass="label label-info">3并列</span></p>          </div>]]></content>
    
    
    <summary type="html">收录文献阅读中的好词好句以及好的表达方式</summary>
    
    
    
    <category term="科研" scheme="http://example.com/categories/%E7%A7%91%E7%A0%94/"/>
    
    
    <category term="科研" scheme="http://example.com/tags/%E7%A7%91%E7%A0%94/"/>
    
    <category term="写作" scheme="http://example.com/tags/%E5%86%99%E4%BD%9C/"/>
    
  </entry>
  
  <entry>
    <title>拥有自己的Deepseek大模型</title>
    <link href="http://example.com/2025/02/10/040%20%E7%A1%85%E5%9F%BA%E6%B5%81%E5%8A%A8%E9%85%8D%E7%BD%AEDeepseek%E5%A4%A7%E6%A8%A1%E5%9E%8B/"/>
    <id>http://example.com/2025/02/10/040%20%E7%A1%85%E5%9F%BA%E6%B5%81%E5%8A%A8%E9%85%8D%E7%BD%AEDeepseek%E5%A4%A7%E6%A8%A1%E5%9E%8B/</id>
    <published>2025-02-10T01:41:00.000Z</published>
    <updated>2025-02-10T02:22:00.388Z</updated>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p>本文最新更新于 2025/02/10 上午</p>          </div><h2 id="打开硅基流动官网注册账号">1、打开硅基流动官网注册账号</h2><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250210095231.png"></p></div><a class="btn" href="https://siliconflow.cn/zh-cn/"  title="硅基流动官网" target="_blank">硅基流动官网</a><blockquote><p>硅基流动专为大模型微调与托管打造的一站式服务平台。通过该平台，用户可以快速、无缝地将自定义模型部署为服务，并根据自己上传的数据进行模型微调。</p></blockquote><p>填写邀请码<code>NShCQzWq</code>，这样的话双方均能获得<code>2000w token</code></p><h2id="下载客户端cherry-studio部署">2、下载客户端<code>Cherry studio</code>部署</h2><a class="btn" href="https://docs.cherry-ai.com/cherrystudio/download"  title="Cherry studio download" target="_blank">Cherry studio download</a><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250210095741.png"></p></div><h2 id="获取api密钥">3、获取api密钥</h2><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250210095840.png"></p></div><p>粘贴入<code>Cherry studio</code></p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250210095942.png"></p></div><p>点击检查，选择<code>deepseek-ai/DeepSeek-R1</code>模型</p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250210100040.png"></p></div><h2 id="开始聊天">4、开始聊天</h2><p>在聊天窗口可切换模型，目前<code>deepseek-ai/DeepSeek-R1</code>有深度思考功能，但速度略慢，<code>deepseek-ai/DeepSeek-V3</code>速度较快。</p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250210100315.png"></p></div><div class="note note-success">            <p>完成</p>          </div>]]></content>
    
    
    <summary type="html">硅基流动配置Deepseek大模型</summary>
    
    
    
    <category term="技术" scheme="http://example.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="大模型" scheme="http://example.com/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"/>
    
    <category term="Deepseek" scheme="http://example.com/tags/Deepseek/"/>
    
  </entry>
  
  <entry>
    <title>Vscode基于aliyun配置Picgo</title>
    <link href="http://example.com/2025/02/09/039%20Vscode%E9%85%8D%E7%BD%AEPicgo/"/>
    <id>http://example.com/2025/02/09/039%20Vscode%E9%85%8D%E7%BD%AEPicgo/</id>
    <published>2025-02-09T13:46:00.000Z</published>
    <updated>2025-02-10T01:30:40.449Z</updated>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p>本文最新更新于 2025/02/09 晚上</p>          </div><p>步骤</p><ol type="1"><li>在vscode扩展商店中下载<code>picgo</code>插件</li></ol><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209221048-2025-02-09.png"></p></div><ol start="2" type="1"><li>点击插件设置，填写必须的信息</li></ol><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209221146-2025-02-09.png"></p></div><ol start="3" type="1"><li>先将上传图床切换成阿里云图床</li></ol><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209221252-2025-02-09.png"></p></div><ol start="4" type="1"><li>创建Bucket</li></ol><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209221357-2025-02-09.png"></p></div><ol start="5" type="1"><li>填写名称，点击创建。</li></ol><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209221451-2025-02-09.png"></p></div><ol start="6" type="1"><li>进入Bucket，修改读写权限为<code>公共权限</code></li></ol><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209221734-2025-02-09.png"></p></div><ol start="7" type="1"><li>在Bucket中创建文件夹，不创建也可，我这里创建一个vscode文件夹</li></ol><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209221713-2025-02-09.png"></p></div><ol start="8" type="1"><li>获取存储空间名称及Bucket域名，记录为param1、param2、param3</li></ol><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209222501-2025-02-09.png"></p></div><ol start="9" type="1"><li>获取访问apikey及秘钥，记录为param4、param4</li></ol><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209222618-2025-02-09.png"></p></div><ol start="10" type="1"><li>将信息填写到vscode插件中</li></ol><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209222739-2025-02-09.png"></p></div><blockquote><p>！！！切记这里填写<code>Custom Url</code>时需在前面加<code>https://</code></p></blockquote><div class="note note-info">            <p>配置完成</p>          </div><p>可以使用snipaste软件或者qq截图软件截图复制到剪贴板，然后再vscode中点击快键键<code>Ctrl+Alt+U</code>粘贴入笔记中</p><p>附上上传的3中方式及快捷键，用的最多的就是截图上传。</p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209223514-2025-02-09.png"></p></div><div class="note note-warning">            <p>注意事项</p>          </div><p>我这里想插入到笔记中后以html格式插入方便修改图片大小，所以将返回格式写成了这种<code>&lt;div style="width: 60%; margin: auto"&gt;\n  &lt;img src="$&#123;url&#125;"&gt;\n&lt;/div&gt;</code>，其中<code>\n</code>代表换行符，如果你不喜欢这种可以使用markdown原本的格式<code>![$&#123;uploadedName&#125;]($&#123;url&#125;)</code></p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209222902-2025-02-09.png"></p></div><p>呈现的效果</p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250209223108-2025-02-09.png"></p></div>]]></content>
    
    
    <summary type="html">实现粘贴图片一键上传云端</summary>
    
    
    
    <category term="技术" scheme="http://example.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="Picgo" scheme="http://example.com/tags/Picgo/"/>
    
    <category term="Vscode" scheme="http://example.com/tags/Vscode/"/>
    
  </entry>
  
  <entry>
    <title>Abaqus学习笔记</title>
    <link href="http://example.com/2025/02/09/038%20Abaqus%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://example.com/2025/02/09/038%20Abaqus%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2025-02-09T13:20:00.000Z</published>
    <updated>2025-02-11T12:24:56.168Z</updated>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p>本文最新更新于 2025/02/10 下午</p>          </div><h2 id="基本介绍">1、基本介绍</h2><a class="btn" href="https://www.bilibili.com/video/BV1j64y1s7Qp?spm_id_from=333.788.videopod.episodes&vd_source=33b50a4dd201d7564e6e63d321809ce9&p=2"  title="学习视频" target="_blank">学习视频</a><h3 id="abaqus的基本功能">1.1 Abaqus的基本功能</h3><ol type="1"><li>计算结构的力学性能——&gt;结构场：静力学动力学（线性非线性）冲击断裂|复材等</li><li>计算结构的热力学性能——&gt;温度场+结构场：稳态、瞬态、线性、非线性</li><li>计算流体的动力学性能——&gt;流场：流速、压力、温度、稳态、瞬态</li><li>计算结构的电磁场性能——&gt;电场/磁场：电感、电容、磁通量、涡流等</li><li>计算结构的NVH性——&gt;结构场+声场：声压、声功率等</li><li>计算耦合场性能——&gt;热结构耦合、热流耦合、热电耦合、流固耦合</li><li>计算结构的优化——&gt;参数优化、非参数优化</li></ol><h3 id="文件系统">1.2 文件系统</h3><ol type="1"><li><strong>数据库文件</strong><ol type="1"><li>模型数据库（.cas）：在Abaqus/CAE中直接打开，包含几个模型、网格、载荷信息及分析任务等；</li><li>结果数据库文件（.odb）：可在Abaqus/CAE中直接打开，也可输入到CAE文件中作为不见或模型，包含在<code>分析步模块</code>中定义的场变量和历史变量输出结果，可以由可视化模块打开。</li></ol></li><li><strong>输入文件</strong><ol type="1"><li><strong>inp文件</strong>：文本文件，可在作业(Job)模块中提交任务时或单击分析作业管理器中的WriteInput按钮在工作目录中生成。Inp文件可以输入模型，也可以由ABAQUSCommand直接运行，inp文件输入的模型只包含有限元模型而无几何模型；</li><li><strong>pes文件</strong>：参数更改后重新的inp文件；</li><li><strong>Par文件</strong>：参数更改后重写的以参数形式运行的inp文件。</li></ol></li><li><strong>日志文件</strong>：Log文件：文本文件，运行ABAQUS的日志。</li><li><strong>数据文件</strong>：Dat文件：文本文件，记录数据和参数检查、单元质量检查等信息，包含预处理inp文件产生的错误和警告信息。包含用户定义的ABAQUS/standard输入数据，ABAQUS/Explicit的结果不会写入其中。</li><li><strong>信息文件</strong><ol type="1"><li><strong>MSG文件</strong>：记录计算过程中的平衡迭代次数、参数设置、计算时间、错误与警告信息等；</li><li><strong>Ipm文件</strong>：气动ABAQUS、CAE分析时开始写入，记录从ABAQUS/Standard或ABAQUS/Explicit到ABAQUS、CAE的过程日志；</li><li><strong>Prt文件</strong>：模型的部件或装配信息；</li><li><strong>Pac文件</strong>：模型信息，仅用于ABAQUS/Explicit。</li></ol></li><li><strong>状态文件</strong><ol type="1"><li><strong>Sta文件</strong>：文本文件，包含分析过程信息；</li><li><strong>Abq文件</strong>：仅用于ABAQUS/Explicit，记录分析、继续和恢复命令；</li><li><strong>Stt文件</strong>：运行数据检查时产生的文件；</li><li><strong>Psr文件</strong>：文本文件，参数化分析要求的输入结果；</li><li><strong>Sel文件</strong>：用于结果选择，仅用于ABAQUS/Explicit。</li></ol></li><li><strong>模型文件</strong>：MDL文件：ABAQUS/Standard与ABAQUS/Explicit中运行数据产生的文件。</li><li><strong>保存命令的文件</strong><ol type="1"><li><strong>Jnl文件</strong>：文本文件，包含于复制已存储的模型数据库的ABAQUS/CAE命令</li><li><strong>Rpy文件</strong>：记录运行一次ABAQUS/CAE所所运用的所有命令</li><li><strong>Rec文件</strong>：包含用于恢复内存中模型数据库的ABAQUS/CAE命令</li></ol></li><li><strong>重启动文件</strong>：Res文件：使用step功能模块进行定义</li><li><strong>脚本文件</strong>：Psf文件：用户定义参数化研究时需要创建的文件</li><li><strong>临时文件</strong><ol type="1"><li><strong>Ods文件</strong>：记录长输出变量的临时运算结果，运行后自动删除</li><li><strong>lck文件</strong>：用于阻止并发写入输出数据库，关闭输出数据库时自动删除</li></ol></li></ol><blockquote><p>在Part导入模块时尽量不要导入igs文件，igs只会包含表面信息。</p></blockquote><h3 id="模块介绍">1.3 模块介绍</h3><ol type="1"><li><strong>Part</strong>：进行零部件建模(3D、2D、轴对称)、模型编辑及修复(去除烂面、抽取中面、模型切割等)</li><li><strong>Property</strong>；创建材料以及截面，完成属性的指派</li><li><strong>Assembly</strong>：组件装配体用于后续分析</li><li><strong>Step</strong>：创建分析步及定义输出</li><li><strong>Interaction</strong>：创建相互作用，包括接触、耦合、弹簧单元、质量单元、焊点等</li><li><strong>Load</strong>：施加载荷、约束以及模型初始条件</li><li><strong>Mesh</strong>：进行网格划分以及单元类型设定</li><li><strong>Optinizatio</strong>n：创建优化任务</li><li><strong>Job</strong>：创建作业以及求解</li><li><strong>Visualization</strong>：可视化后处理</li><li><strong>Sketch</strong>：创建草图，可用于零部件建模</li></ol><h3 id="单位制问题">1.4 单位制问题</h3><div style="width: 80%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/vscode/20250210165813.png"></p></div><h3 id="操作技巧">1.5 操作技巧</h3><ol type="1"><li><code>ctrl+shift+中键</code>：移动</li><li><code>ctrl+shift+左键</code>：旋转</li><li><code>ctrl+shift+右键</code>：缩放</li></ol><h2 id="part模块">2、Part模块</h2><a class="btn" href="https://www.bilibili.com/video/BV1j64y1s7Qp?spm_id_from=333.788.videopod.episodes&vd_source=33b50a4dd201d7564e6e63d321809ce9&p=3"  title="学习视频" target="_blank">学习视频</a><p>选择面或者线时：要按住<code>Alt</code>键</p>]]></content>
    
    
    <summary type="html">Abaqus基础</summary>
    
    
    
    <category term="模拟" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="Abaqus" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/Abaqus/"/>
    
    
    <category term="模拟" scheme="http://example.com/tags/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="学习笔记" scheme="http://example.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="Abaqus" scheme="http://example.com/tags/Abaqus/"/>
    
  </entry>
  
  <entry>
    <title>Rust学习笔记</title>
    <link href="http://example.com/2025/02/08/037%20Rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://example.com/2025/02/08/037%20Rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2025-02-08T07:43:00.000Z</published>
    <updated>2025-02-08T11:39:14.900Z</updated>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p>本文最新更新于 2025/02/08 晚上</p>          </div><h1 id="安装与配置">1、安装与配置</h1><h2 id="安装">1.1 安装</h2><p><ahref="https://www.rust-lang.org/zh-CN/learn/get-started">官网下载</a></p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241028185911269.png"alt="image-20241028185911269" /><figcaption aria-hidden="true">image-20241028185911269</figcaption></figure><p>双击打开会弹出命令行窗口，直接回车即可。</p><p>查看是否安装成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rustup --version<br></code></pre></td></tr></table></figure><p>查看rust版本环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rustup show<br></code></pre></td></tr></table></figure><p>安装生产版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rustup install nightly<br></code></pre></td></tr></table></figure><p>切换版本环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">rustup default nightly<br>or<br>rustup default stable<br></code></pre></td></tr></table></figure><h2 id="编译命令">1.2 编译命令</h2><p>文件编译</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">rustc 被编译文件名 -o 输出文件名<br>rustc main.rs -o hello<br></code></pre></td></tr></table></figure><h1 id="包管理">2、包管理</h1><h2 id="包管理工具cargo">2.1 包管理工具<code>Cargo</code></h2><p><strong><u>创建项目</u></strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">cargo new project_name<br>cargo new --lib project_lib_name<br></code></pre></td></tr></table></figure><p><strong><u>构建项目</u></strong></p><p>会出现一个名为<code>target</code>文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">cargo build<br>cargo build --release  这个性能较好<br></code></pre></td></tr></table></figure><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241028191914203.png"alt="image-20241028191914203" /><figcaption aria-hidden="true">image-20241028191914203</figcaption></figure><p><strong><u>检测</u></strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cargo check<br></code></pre></td></tr></table></figure><p><strong><u>运行/测试</u></strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">cargo run<br>cargo <span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure><p><strong><u>项目结构</u></strong></p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241028190911111.png"alt="image-20241028190911111" /><figcaption aria-hidden="true">image-20241028190911111</figcaption></figure><h2 id="cargo.toml文件">2.2 Cargo.toml文件</h2><ul><li>package<ul><li>设置版本名</li><li>版本等</li></ul></li><li>dependencies<ul><li>设置依赖</li><li>[build-dependencies]列出了在构建项目时需要的依赖项</li><li>[dev-dependencies]列出了只在开发时需要的依赖项</li></ul></li></ul><h2 id="加载库">2.3 加载库</h2><p>填写依赖项后保存会自动加载依赖项</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241028192529489.png"alt="image-20241028192529489" /><figcaption aria-hidden="true">image-20241028192529489</figcaption></figure><p>推荐使用<code>cargo-edit</code></p><p>安装<code>cargo-edit</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cargo install cargo-edit<br></code></pre></td></tr></table></figure><p>添加库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cargo add dependency_name<br></code></pre></td></tr></table></figure><p>安装指定版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cargo add dependency_name@1.2.3<br></code></pre></td></tr></table></figure><p>添加开发时用的依赖库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cargo add --dev dev_dependency_name<br></code></pre></td></tr></table></figure><p>添加构建时用的依赖库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cargo add --build build_dependency_name<br></code></pre></td></tr></table></figure><p>删除库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cargo <span class="hljs-built_in">rm</span> dependency_name<br></code></pre></td></tr></table></figure><h2 id="设置国内源">2.4 设置国内源</h2><p>推荐使用<code>rsproxy</code></p><p>在<code>C:\Users\23984\.cargo\.config</code></p><p>但是我没有找到</p><h1 id="基本类型">3、基本类型</h1><h2 id="变量与不可变性">3.1 变量与不可变性</h2><ol type="1"><li>使用<code>let</code>声明变量</li><li>后置类型定义</li><li>变量使用蛇形命名法，枚举和结构体命名使用帕斯卡命名法</li><li>强制类型转换<code>Casting a Value to a Different Type</code></li><li>使用<code>mut</code>关键词将变量置为可变</li><li></li></ol><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241028194646626.png"alt="image-20241028194646626" /><figcaption aria-hidden="true">image-20241028194646626</figcaption></figure><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241028194723176.png"alt="image-20241028194723176" /><figcaption aria-hidden="true">image-20241028194723176</figcaption></figure><h2 id="常量与静态变量">3.2 常量与静态变量</h2><p><strong><u>常量</u></strong></p><ol type="1"><li>常量的值在编译时已知，必须指定类型与值</li><li>与C不同，Rust的const常量值被直接嵌入到生成的底层机器代码中，而不是简单字符替换</li><li>常量名与静态变量名必须全部大写，单词之间加下划线</li><li>常来那个的作用域是块级作用域，只在声明他们的作用域内可见</li></ol><p><strong><u>static静态变量</u></strong></p><ol type="1"><li>在运行时分配内存</li><li>并不是不可变的，可使用unsafe修改</li><li>静态变量的生命周期为整个程序的运行时间</li></ol><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241028200046092.png"alt="image-20241028200046092" /><figcaption aria-hidden="true">image-20241028200046092</figcaption></figure><h2 id="基本数据类型">3.3 基本数据类型</h2><ul><li><code>Integer types</code> ： 默认推断为<code>i32</code><ul><li>i8、i16、i32、i64、i128</li></ul></li><li><code>Unsigned Integer types</code><ul><li>u8、u16、u32、u64、u128</li></ul></li><li>platform-specific integer type（由平台决定）<ul><li>usize</li><li>isize</li></ul></li><li>Float Types<ul><li>f32与f64</li><li>尽量用f64</li></ul></li><li>Boolean Values<ul><li>true</li><li>false</li></ul></li><li>Character Types<ul><li>Rust支持Unicode字符</li><li>表示char类型使用单引号</li></ul></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,<span class="hljs-type">u32</span>::MAX);<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,<span class="hljs-type">u32</span>::MIN);<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,<span class="hljs-type">usize</span>::MAX);<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,<span class="hljs-type">usize</span>::MIN);<br><span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;isize is &#123;&#125; bytes&quot;</span>,std::mem::size_of::&lt;<span class="hljs-type">isize</span>&gt;());<br></code></pre></td></tr></table></figure><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241028200813404.png"alt="image-20241028200813404" /><figcaption aria-hidden="true">image-20241028200813404</figcaption></figure><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241028200822258.png"alt="image-20241028200822258" /><figcaption aria-hidden="true">image-20241028200822258</figcaption></figure><p>该2.4了</p><p>https://www.bilibili.com/video/BV15y421h7j7?spm_id_from=333.788.videopod.episodes&amp;vd_source=33b50a4dd201d7564e6e63d321809ce9&amp;p=7</p><h2 id="元祖和数组">3.4 元祖和数组</h2><p>相同点：</p><ul><li>都是复合类型Compound Types，而Vec和Map都是集合类型CollectionTypes</li><li>元组和数组长度都是固定的</li></ul><p>不同点：</p><ul><li>Tuples：不同类型的数据类型</li><li>Arrays：同一类型的数据类型</li></ul><p><u><strong>数组：</strong></u></p><ul><li><p>创建方式</p><ul><li><p><code>[a,b,c]</code></p></li><li><p><code>[value;size]</code></p></li></ul></li><li><p>获取元素<code>arr[index]</code></p></li><li><p>获取长度<code>arr.len()</code></p></li></ul><p><strong><u>元组：</u></strong></p><ul><li>获取数据：tup.index</li><li>没有len()</li><li>默认返回值<code>Emoty Tuple()</code></li></ul><blockquote><ul><li>元组和数组都是可以直接打印的；<code>println!("&#123;:?&#125;",arr);</code></li><li>赋值默认都是<code>copy</code>操作；</li></ul></blockquote><p>string赋值时是<code>move</code>操作，会转移所有权，不能再打印。</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241029191648931.png"alt="image-20241029191648931" /><figcaption aria-hidden="true">image-20241029191648931</figcaption></figure><h1 id="ownership与结构体枚举">4、Ownership与结构体、枚举</h1><h2 id="rust的内存管理模型">4.1 Rust的内存管理模型</h2><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241029191949573.png"alt="image-20241029191949573" /><figcaption aria-hidden="true">image-20241029191949573</figcaption></figure><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241029192441011.png"alt="image-20241029192441011" /><figcaption aria-hidden="true">image-20241029192441011</figcaption></figure><p><strong><u>1、所有权系统</u></strong></p><ul><li>每个值都有一个与之关联的变量，该变量是该值的所有者</li><li>同一时间只能有一个所有者</li><li>当所有者离开作用域时，它拥有的值将被丢弃</li></ul><p><strong><u>2、RAII原则</u></strong></p><p>资源获取即初始化原则。当对象被创建时，它会获取必要的资源，并在生命周期结束时释放这些资源。</p><blockquote><p>https://blog.csdn.net/CrystalLawson/article/details/138190719</p></blockquote>]]></content>
    
    
    <summary type="html">Rust基础</summary>
    
    
    
    <category term="编程" scheme="http://example.com/categories/%E7%BC%96%E7%A8%8B/"/>
    
    <category term="Rust" scheme="http://example.com/categories/%E7%BC%96%E7%A8%8B/Rust/"/>
    
    
    <category term="学习笔记" scheme="http://example.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="Rust" scheme="http://example.com/tags/Rust/"/>
    
  </entry>
  
  <entry>
    <title>深度学习基础</title>
    <link href="http://example.com/2025/02/08/036%20%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8%EF%BC%88%E5%90%B4%E6%81%A9%E8%BE%BE%EF%BC%89/"/>
    <id>http://example.com/2025/02/08/036%20%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8%EF%BC%88%E5%90%B4%E6%81%A9%E8%BE%BE%EF%BC%89/</id>
    <published>2025-02-08T07:11:00.000Z</published>
    <updated>2025-02-10T01:30:40.447Z</updated>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p>本文最新更新于 2025/02/08 晚上</p>          </div><span class="label label-primary">梯度下降</span><span class="label label-info">线性回归</span><span class="label label-warning">学习率</span><hr /><a class="btn" href="https://github.com/kaieye/2022-Machine-Learning-Specialization"  title="Github资料" target="_blank">Github资料</a><h2 id="机器学习分类">1、机器学习分类</h2><p>分为监督学习和无监督学习</p><h3 id="监督学习">1.1 监督学习</h3><ul><li>定义：在给定的数据集中学习出一个函数，当输入新的x时，能够预测输出结果y。</li><li>两种主要类型：回归和分类</li><li>学习技术：逻辑回归、线性回归、决策树和神经网络。</li></ul><h3 id="无监督学习">1.2 无监督学习</h3><ul><li>无监督学习算法会使用未标记的数据进行训练。</li><li>无监督学习可用于将新闻文章分类</li><li>学习技术：集群、关联规则学习、概率密度和降维</li></ul><h3 id="区别">1.3 区别</h3><ul><li>监督学习是一种目的明确的训练方式，你知道得到的是什么；而<strong>无监督学习则是没有明确目的的训练方式，你无法提前知道结果是什么</strong>。</li><li>监督学习由于目标明确，所以可以衡量效果；而<strong>无监督学习几乎无法量化效果如何</strong>。</li></ul><div class="note note-info">            <ol type="1"><li><ahref="https://aws.amazon.com/cn/compare/the-difference-between-machine-learning-supervised-and-unsupervised/">有监督学习和无监督学习有什么区别</a></li><li><ahref="https://easyai.tech/ai-definition/unsupervised-learning/">无监督学习– Unsupervised learning | UL</a></li></ol>          </div><h2 id="线性回归">2、线性回归</h2><h3 id="定义">2.1 定义</h3><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202409161210625.png"></p></div><p>任何预测数字之间的监督学习模型都可被称作回归问题。线性回归时回归模型中的一个用例。模型可以有无限可能的输出。</p><p>Training : Data used to train the model</p><ul><li>x : 输入</li><li>y : 输出</li><li>m : 训练集的数量</li><li>(x,y) : 单个训练样本</li><li>$ (x<sup>{i},y</sup>{i}) $ : 第i个训练样本fs</li><li><span class="math inline">\(\hat{y}\)</span> : 预测值</li><li>f : 函数模型</li><li><span class="math inline">\(\hat{y}-y\)</span> : error</li></ul><blockquote><p>另一种机器学习类别是分类，分类问题时预测类别或者离散类别，如预测图片是猫还是狗。在分类问题中，只有少量可能的输出。</p></blockquote><h3 id="损失函数">2.2 损失函数</h3><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202409161303796.png"></p></div><p>模型 <span class="math display">\[f_{w,b}(x)=wx+b\]</span> 参数为w和b <span class="math display">\[J(w,b)=\frac{1}{2m}\sum_{i=1}^{m}\bigl(f_{w,b}\bigl(x^{(i)}\bigr)-y^{(i)}\bigr)^{2}\]</span></p><blockquote><p><span class="math inline">\(J(w,b)\)</span>最小化</p></blockquote><p>为方便举例，假设只有一个参数w。如图所示，当参数w为1时，J(w)时是最小的</p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202409161301562.png"></p></div><p>如果参数有w和b则</p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202409161303421.png"></p></div><p>或者</p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202409161307927.png"></p></div><p>完整对应关系</p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202409161309467.png"></p></div><h2 id="梯度下降">3、梯度下降</h2><p>有时我们的损失值J并不是规则的，如图所示，存在诸多小峰和低谷。机器学习的目标就是找到最低点，如何快速找到最低点至关重要。</p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202409161313907.png"></p></div><p>假设你站在一个山坡上，如何找到最快的下坡路线？即朝哪个方向迈出一步？每走一步都要再次确认下一步往哪迈。</p><blockquote><p>实现梯度下降</p></blockquote><p><span class="math display">\[w=w-\alpha\frac\partial{\partial w}J(w,b)\]</span></p><p><span class="math display">\[b=b-\alpha\frac\partial{\partial b}J(w,b)\]</span></p><p>学习率<spanclass="math inline">\(\alpha\)</span>决定下坡的步数大小</p><blockquote><p>对于某个特定步的两个量(w,b)的更新，<spanclass="math inline">\(\frac\partial{\partialw}J(w,b)\)</span>要一致。</p></blockquote><p><span class="math display">\[tmp_w = w-\alpha\frac\partial{\partial w}J(w,b)\]</span></p><p><span class="math display">\[tmp_b = b-\alpha\frac\partial{\partial b}J(w,b)\]</span></p><p><span class="math display">\[w = tmp_w\]</span></p><p><span class="math display">\[b = tmp_b\]</span></p><p><strong>直观理解梯度下降</strong></p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240918185034.png"></p></div><h3 id="学习率">3.1 学习率</h3><p>学习率的值至关重要，太小和太大会产生什么影响呢？</p><ul><li>太小学习很慢</li><li>太大可能会离最小值越来越远，导致发散</li></ul><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240918185505.png"></p></div><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240918185512.png"></p></div><p>固定的学习率，下降的步长会越来越小，因为导数在变小</p><div style="width: 60%; margin: auto"><p><img src="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240918185832.png"></p></div><h3 id="线性回归中的梯度下降">3.2 线性回归中的梯度下降</h3><p><span class="math display">\[f_{w,b}(x)=wx+b\]</span></p><p><span class="math display">\[J(w,b)=\frac{1}{2m}\sum_{i=1}^{m}(f_{w,b}(x^{(i)})-y^{(i)})^{2}\]</span></p><p><span class="math display">\[w=w-\alpha\frac{\partial}{\partial w}J(w,b)\]</span></p><p><span class="math display">\[b=b-\alpha\frac{\partial}{\partial b}J(w,b)\]</span></p><p>而</p><p><span class="math display">\[\frac{\partial}{\partial w}J(w,b) =\frac{1}{m}\sum_{i=1}^{m}(f_{w,b}\big(x^{(i)}\big)-y^{(i)})x^{(i)}\]</span></p><p><span class="math display">\[\frac{\partial}{\partial w}J(w,b) =\frac{1}{m}\sum_{i=1}^{m}(f_{w,b}\big(x^{(i)}\big)-y^{(i)})\]</span></p><p>则</p><p><span class="math display">\[w=w-\alpha\frac{1}{m}\sum_{i=1}^{m}(f_{w,b}(x^{(i)})-y^{(i)}) x^{(i)}\]</span></p><p><span class="math display">\[b=b-\alpha\frac{1}{m}\sum_{i=1}^{m}(f_{w,b}(x^{(i)})-y^{(i)})\]</span></p><blockquote><p>梯度下降只能找到局部最小值，而不能找到全局最小值。对于凸函数只有一个最小值，梯度下降是适用的</p></blockquote><h2 id="多元线性回归">4、多元线性回归</h2><p>多元线性回归模型中有多个特征值。比如房间的价格Y不止与面积X1有关，还与地段X2、房间数X3等有关。此时的X实际为一个向量[X1,X2,X3]。此时模型可以定义为</p><p><span class="math display">\[f_{\overrightarrow{w},b}(\overrightarrow{X})=w_{1}X_{1}+w_{2}X_{2}+w_{3}X_{3}+b\]</span></p><p><span class="math display">\[\overrightarrow{w} = [X1,X2,X3]\]</span></p><p><span class="math display">\[f_{\overrightarrow{w},b}(\overrightarrow{X})=\overrightarrow{w}\cdot\overrightarrow{X}+ b\]</span></p><p><strong>向量化</strong></p><p><spanclass="math display">\[f=w[0]*x[0]+w[1]*x[1]+w[2]*x[2]+b\]</span>代码表示</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">f = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,n):<br>  f = f + w[j] * x[j]<br>f = f + b<br><br>// 也可以使用numpy，这种方式计算效率高，因为numpy可以并行计算<br>f = np.dot(w,x) + b<br></code></pre></td></tr></table></figure><p><strong>向量中的梯度算法</strong></p><a class="btn" href="https://www.bilibili.com/video/BV1Bq421A74G?p=24&vd_source=33b50a4dd201d7564e6e63d321809ce9"  title="视频讲解" target="_blank">视频讲解</a><p>多个特征值</p><p><span class="math display">\[\begin{align*} \text{repeat}&amp;\text{ until convergence:} \; \lbrace\newline\;&amp; w_j = w_j -  \alpha \frac{\partial J(\mathbf{w},b)}{\partial w_j}\tag{5}  \; &amp; \text{for j = 0..n-1}\newline&amp;b\ \ = b -  \alpha \frac{\partial J(\mathbf{w},b)}{\partial b} \newline \rbrace\end{align*}\]</span></p><p><span class="math display">\[\frac{\partial J(\mathbf{w},b)}{\partialw_j}=\frac{1}{m}\sum_{i=0}^{m-1}(f_{\mathbf{w},b}(\mathbf{x}^{(i)})-y^{(i)})x_j^{(i)}\]</span></p><p><span class="math display">\[\frac{\partial J(\mathbf{w},b)}{\partialb}=\frac{1}{m}\sum_{i=0}^{m-1}(f_{\mathbf{w},b}(\mathbf{x}^{(i)})-y^{(i)})\]</span></p><h3 id="梯度下降特征放缩">4.1 梯度下降:特征放缩</h3><p>如果两个特征值在量级上相差较大，如房间数和面积，房间数一般在1<sub>5，而面积在100</sub>150，这时绘制出的w1和w2的J(w,b)呈现椭圆形，在梯度下降时会来回反弹。最有利的方式是将特征值进行放缩，使得两个特征值在相同量级。</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240924084546.png"alt="image.png|500" /><figcaption aria-hidden="true">image.png|500</figcaption></figure><h3 id="如何缩放">4.2 如何缩放</h3><p><strong>最值归一化</strong></p><p>除以特征值取值的最大值，数据会映射到0~1之间。 <spanclass="math display">\[x_{scale}=\frac{x-x_{min}}{x_{max}-x_{min}}\]</span>最值归一化只适用于有明显边间的情况。</p><p><strong>均值归一化</strong></p><p><span class="math display">\[x_{scale}=\frac{x-\mu}S\]</span>其中<span class="math inline">\(x\)</span>为要归一化的值，<spanclass="math inline">\(x_{scale}\)</span>为归一化之后的值。<spanclass="math inline">\(\mu\)</span> 为样本的平均值，<spanclass="math inline">\(S\)</span>为样本的标准差。</p><p><strong>均值方差归一化</strong></p><p><span class="math display">\[Y_i=\sigma\cdot X_i+\mu \]</span>其中，X为标准正态分布中的元素，<spanclass="math inline">\(\mu\)</span>为平均值，<spanclass="math inline">\(\sigma\)</span>为标准差。</p><h3 id="学习曲线">4.3 学习曲线</h3><p>可以判断何时停止训练特定模拟</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240927140525.png"alt="image.png|500" /><figcaption aria-hidden="true">image.png|500</figcaption></figure><h3 id="学习率选择">4.4 学习率选择</h3><p>一个小的学习率，J应该是持续减小的。在选择学习率时，可从小的开始，每次增加10倍改变，如0.001、0.01、0.1、1、10...</p>]]></content>
    
    
    <summary type="html">跟着吴恩达学习深度学习基础</summary>
    
    
    
    <category term="编程" scheme="http://example.com/categories/%E7%BC%96%E7%A8%8B/"/>
    
    <category term="大模型" scheme="http://example.com/categories/%E7%BC%96%E7%A8%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"/>
    
    
    <category term="深度学习" scheme="http://example.com/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="吴恩达" scheme="http://example.com/tags/%E5%90%B4%E6%81%A9%E8%BE%BE/"/>
    
  </entry>
  
  <entry>
    <title>AI生成代码</title>
    <link href="http://example.com/2025/02/08/035%20AI%E9%97%AE%E7%AD%94%E5%BD%A2%E5%BC%8F%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81/"/>
    <id>http://example.com/2025/02/08/035%20AI%E9%97%AE%E7%AD%94%E5%BD%A2%E5%BC%8F%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81/</id>
    <published>2025-02-08T07:06:00.000Z</published>
    <updated>2025-02-08T11:39:20.848Z</updated>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p>本文最新更新于 2025/02/08 晚上</p>          </div><h2 id="ai问答形式生成代码">AI问答形式生成代码</h2><p>今天无意间在b站看到一位up主用AI写代码的过程，无比惊讶，不需要会前端，就能使用问答的形式生成好看的前端页面。我也亲自体验了一下。</p><p>https://v0.dev/chat/</p><p>这是我使用这个网站生成的前端页面，但是每天有限制次数，<u>一定要谨慎使用，想好了问题再问。</u></p><h2 id="预览">预览</h2><p>https://v0.dev/chat/GvO3hYBppbW</p><h2 id="问答生成">问答生成</h2><p>有样学样，首先给他生成网站的目的及类型。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">I</span> want <span class="hljs-selector-tag">to</span> make an app for university applicants. <span class="hljs-selector-tag">To</span> learn about major. <span class="hljs-selector-tag">I</span> want <span class="hljs-selector-tag">to</span> <span class="hljs-attribute">display</span> <span class="hljs-selector-tag">a</span> list of major, and their coresponging subject, and comparisons between majors. Now generate the major list page.<br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123143611587.png"alt="image-20241123143611587" />​</p><p>但显示的内容过于多，而不是自己想要的，我想要在主页面能呈现更多的专业</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">but </span>make it more concise, <span class="hljs-keyword">because </span>there are <span class="hljs-keyword">bundreds </span>of majors i want to <span class="hljs-keyword">display </span>in the home page<br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123143748042.png"alt="image-20241123143748042" />​</p><p>它还贴心的加上了搜索功能，但是我想着美化一下，添加一个主题颜色</p><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs openscad"><span class="hljs-keyword">use</span> clean <span class="hljs-built_in">color</span> themes<br></code></pre></td></tr></table></figure><p>但是单词打错了，<code>clear</code>写成了<code>clean</code>，它把所有颜色删除了。当时我没意识到，只是让它在搜索栏右侧添加一个筛选按钮，可以筛选分类。</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">add </span>a category <span class="hljs-keyword">button </span><span class="hljs-built_in">at</span> search <span class="hljs-keyword">box </span>right, I can choose <span class="hljs-keyword">different </span>category<br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123144043521.png"alt="image-20241123144043521" />​</p><p>还是不甘心，加点颜色主题吧</p><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs openscad"><span class="hljs-keyword">use</span> gradient <span class="hljs-built_in">color</span> theme<br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123144129571.png"alt="image-20241123144129571" />​</p><p>但这个紫色系不是我想要的，想要个蓝色系的。</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">use gradient <span class="hljs-keyword">color</span> theme <span class="hljs-keyword">about</span> blue<br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123144236324.png"alt="image-20241123144236324" />​</p><p>生成一个详情页面</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">generate</span> a <span class="hljs-keyword">new</span> page <span class="hljs-keyword">for</span> major detail, <span class="hljs-keyword">this</span> page should contain subjects related to <span class="hljs-number">10</span> majors.<br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123144410492.png"alt="image-20241123144410492" />​</p><p>这个页面有些简单，增加一下问答功能</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">detail page should have comment <span class="hljs-keyword">and</span> question / answer seciotn <span class="hljs-keyword">below</span><br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123144451374.png"alt="image-20241123144451374" />​</p><p>但是推荐的专业里面推荐的是大分类，想改成大分类中的小分类</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">The recommended major is <span class="hljs-keyword">the</span> minor major <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> larger category <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> detail page<br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123144604904.png"alt="image-20241123144604904" />​</p><p>生成专业对比页面</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">generate a new page about major <span class="hljs-built_in">compare</span>. Side-<span class="hljs-keyword">by-side </span><span class="hljs-built_in">compare</span> <span class="hljs-number">2</span> major majors interm of suject to study, related <span class="hljs-keyword">jobs, </span><span class="hljs-keyword">and </span>more. <span class="hljs-keyword">be </span>creative.<br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123144639352.png"alt="image-20241123144639352" />​</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123144650053.png"alt="image-20241123144650053" />​</p><p>还想优化一下，但是今日的生成次数用尽了。总之这个网站对我的冲击还是比较大的。一时间让我感觉自己之前学的东西都白费了，自己一天写的网站，它使用几分钟就能搞定，而且还美观。不得不惊叹目前AI发展的速度，自己还是要掌握一些核心技能，不然免不了被淘汰。</p><h2 id="全部页面">全部页面</h2><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123143233687.png"alt="image-20241123143233687" />​</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123143249198.png"alt="image-20241123143249198" />​</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123143259159.png"alt="image-20241123143259159" />​</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123143337907.png"alt="image-20241123143337907" />​</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20241123143346607.png"alt="image-20241123143346607" />​</p>]]></content>
    
    
    <summary type="html">使用v0.dev.chat以问答形式生成代码测试</summary>
    
    
    
    <category term="技术" scheme="http://example.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="AI代码生成" scheme="http://example.com/tags/AI%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90/"/>
    
    <category term="大模型" scheme="http://example.com/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"/>
    
    <category term="v0.chat" scheme="http://example.com/tags/v0-chat/"/>
    
  </entry>
  
  <entry>
    <title>在powershell上禁止运行脚本</title>
    <link href="http://example.com/2025/02/08/034%20Powershell%E9%99%90%E5%88%B6/"/>
    <id>http://example.com/2025/02/08/034%20Powershell%E9%99%90%E5%88%B6/</id>
    <published>2025-02-08T06:33:00.000Z</published>
    <updated>2025-02-08T11:39:29.438Z</updated>
    
    <content type="html"><![CDATA[<div class="note note-success">            <p>本文最新更新于 2025/02/08 下午</p>          </div><p>在使用<code>tabby</code>运行<code>PowerShell</code>时，输入命令行<code>hexo s</code>出现如下报错</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/picgo/image-20250208144105189.png"alt="image-20250208144105189" /><figcaption aria-hidden="true">image-20250208144105189</figcaption></figure><p><strong>分析原因</strong></p><p><code>PowerShell</code>执行策略是<code>Restricted</code>。<code>Restricted</code> 执行策略不允许任何脚本运行。</p><p>查看执行策略<code>get-executionpolicy</code></p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/picgo/image-20250208143829255.png"alt="image-20250208143829255" /><figcaption aria-hidden="true">image-20250208143829255</figcaption></figure><p><strong>解决方法</strong></p><p>管理员身份打开<code>PowerShell</code> 输入<code>set-executionpolicy remotesigned</code>更改执行策略</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/picgo/image-20250208143928799.png"alt="image-20250208143928799" /><figcaption aria-hidden="true">image-20250208143928799</figcaption></figure>]]></content>
    
    
    <summary type="html">解决在powershell禁止运行脚本问题</summary>
    
    
    
    <category term="技术" scheme="http://example.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="powershell" scheme="http://example.com/tags/powershell/"/>
    
  </entry>
  
  <entry>
    <title>The Spalart-Allmaras Turbulence Model</title>
    <link href="http://example.com/2024/07/30/033%20%E6%B9%8D%E6%B5%81%E6%A8%A1%E5%9E%8B%E4%B9%8BSpalart-Allmaras/"/>
    <id>http://example.com/2024/07/30/033%20%E6%B9%8D%E6%B5%81%E6%A8%A1%E5%9E%8B%E4%B9%8BSpalart-Allmaras/</id>
    <published>2024-07-30T11:26:00.000Z</published>
    <updated>2025-02-08T06:47:20.944Z</updated>
    
    <content type="html"><![CDATA[<h1 id="历史发展">1、历史发展</h1><p>流体动力学中描述流体在外力作用下流动的主要控制方程是<strong>纳维-斯托克斯方程</strong>。这些方程的强大之处在于它们能够描述作用在流体上的任何力的影响以及由此产生的流动行为。然而，<em>它们不能针对每个系统或流量情况以封闭形式求解。</em></p><p>由于最早 1973 年提出的 ke 模型无法准确预测逆压力梯度 adverse pressuregradient 下的边界层运动，Spalart-Allmaras Model（1994）、（1998）以及（1994）分别被提出。</p><p>在物理学中，Spalart-Allmaras模型是一种单方程模型，可求解运动涡流湍流粘度的模拟输运方程。在其原始形式中，该模型实际上是一个低雷诺数模型，需要正确解析边界层的粘度影响区域（y+~1个网格）。它没有针对一般工业流动进行标定，对于一些自由剪切流，尤其是平面和圆形射流，确实会产生较大的误差。此外，不能依靠它来预测均匀、各向同性湍流的衰减。</p><h1 id="基本形式">2、基本形式</h1><p><spanclass="math display">\[\tau_{ij}=2\mu_t\left(S_{ij}-\frac{1}{3}\frac{\partialu_k}{\partial x_k}\delta_{ij}\right)-\frac{2}{3}\rhok\delta_{ij}\]</span></p><p>Spalart-Allmaras 湍流模型遵循一个描述运动粘度类变量（称为Spalart-Allmaras 变量）的动态方程：</p><p><span class="math display">\[\frac{\partial\bar{v}}{\partialt}+u_{j}\frac{\partial\bar{v}}{\partialx_{j}}=C_{b,1}(1-f_{t,2})\hat{S}\bar{v}-[c_{w,1}f_{w}-\frac{c_{b,1}}{\kappa^{2}}f_{t,2}](\frac{\bar{v}}{d})^{2}+\frac{1}{\sigma}[\frac{\partial}{\partialx_{j}}((v+\bar{v})\frac{\partial\bar{v}}{\partialx_{j}})+c_{b,2}\frac{\partial\bar{v}}{\partialx_{i}}\frac{\partial\bar{v}}{\partial x_{i}}]\]</span></p><p>该方程的目标是确定湍流涡流粘度，其由以下公式确定：</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240730194639.png" /></p><p>在这些方程中，分子运动粘度为 𝜈 = μ/⍴，流体密度为 ⍴，μ是流体的分子动力粘度。模型中的其他参数以场点到最近壁 d的距离和涡度大小给出</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240730194722.png" /></p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240730194738.png" /></p><p>以下定义：</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240730194758.png" /></p><p>从上面的定义中可以看出几个常量。这些常量定义如下：</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240730194819.png" /></p><p>由于所考虑的系统以墙为界，因此沿着墙的表面有一个固定边界条件。其他边界条件可能会施加在系统的其他地方，尽管这些边界条件是否会干扰解决远离壁本身的涡流可能值得怀疑。最后，我们对远场Spalart-Allmaras 变量有以下条件：</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240730194845.png" /></p><p>优点：</p><ol type="1"><li>降维可以降低问题的复杂性和整体模拟时间。</li><li>无需使用沿湍流的剪切层的局部厚度来计算长度尺度。</li><li>对于具有<strong>任意压力梯度</strong>的边界层流很有用。</li><li>稳健；对于低雷诺数 k - ε模型不收敛甚至发散的相对粗糙的网格，它可以给出合理的结果</li></ol><p>缺点：</p><ol type="1"><li>不适用于涉及喷射状自由剪切区域的应用</li><li></li></ol><h1 id="用途">3、用途</h1><h1 id="注意事项">4、注意事项</h1><p>参考：</p><ol type="1"><li>https://resources.system-analysis.cadence.com/blog/msa2024-what-is-the-spalart-allmaras-turbulence-model</li><li>https://www.cfd-online.com/Wiki/Spalart-Allmaras_model</li><li>https://www.youtube.com/watch?v=Xivc0EIGFQw</li><li>https://zhuanlan.zhihu.com/p/408434524</li></ol>]]></content>
    
    
    <summary type="html">介绍The Spalart-Allmaras Turbulence Model的历史及公式</summary>
    
    
    
    <category term="模拟" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="Fluent" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/Fluent/"/>
    
    
    <category term="Fluent" scheme="http://example.com/tags/Fluent/"/>
    
    <category term="模拟" scheme="http://example.com/tags/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="学习笔记" scheme="http://example.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="湍流模型" scheme="http://example.com/tags/%E6%B9%8D%E6%B5%81%E6%A8%A1%E5%9E%8B/"/>
    
  </entry>
  
  <entry>
    <title>Python自动执行fluent</title>
    <link href="http://example.com/2024/07/30/032%20Python%E8%87%AA%E5%8A%A8%E6%89%A7%E8%A1%8Cfluent/"/>
    <id>http://example.com/2024/07/30/032%20Python%E8%87%AA%E5%8A%A8%E6%89%A7%E8%A1%8Cfluent/</id>
    <published>2024-07-30T10:53:00.000Z</published>
    <updated>2025-02-08T06:47:20.944Z</updated>
    
    <content type="html"><![CDATA[<h1 id="tui-命令">TUI 命令</h1><p>TUI 命令包括 Fluent 中的全部设置，见上一篇 Fluent TUI 命令。</p><p>最重要的是要包含推出程序命令，即<code>exit ok</code></p><p>全部 TUI 命令如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs tui">; 1、读取网格文件<br>rc fluent.msh<br>mesh/check<br>mesh/quality<br><br><br>display mesh-outline<br><br>; 2、勾选瞬态<br>/define/models/unsteady-2nd-order yes<br><br>; 3、设置重力加速度<br>/define/operating-conditions/gravity yes 0 -9.81 0<br><br>; 4、开启能量方程<br>/define/models/energy y y y<br><br>; 5、湍流模型<br>/define/models/viscous/spalart-allmaras y<br><br>; 6、新增混合气体<br>/define/models/species/species-transport y hydrogen-air<br>/define/materials/change-create hydrogen-air hydrogen-air y 2 h2 air 0 0 n n n n n n<br><br>; 7、管道材料及土壤材料<br>/define/materials/copy/solid/steel<br>/define/materials/change-create aluminum soil y constant 2650 y constant 789 y constant 2.9 y<br><br>; 8、设置边界条件<br>/define/boundary-conditions/fluid solid fluid no no no no no  0 no 0 no 0 no  0 no 0 no 0 no no no no yes no no 1 no 0 no 0 no  0 no 1 no 0 yes no 245000000000 no 245000000000 no 245000000000 no no 502000 no 502000 no 502000 0 0 no 0.43 constant 1 yes no no no<br><br>/define/boundary-conditions/zone-type inlet pressure-inlet<br>/define/boundary-conditions/set/pressure-inlet inlet () p0 no 400000 q<br>/define/boundary-conditions/set/pressure-inlet inlet () supersonic/initial-gauge-pressure no 400000 q<br>/define/boundary-conditions/set/pressure-inlet inlet () ke-spec no no no yes q<br>/define/boundary-conditions/set/pressure-inlet inlet () turb-hydraulic-diam 0.01 q<br>/define/boundary-conditions/set/pressure-inlet inlet () t0 no 288.15 q<br>/define/boundary-conditions/set/pressure-inlet inlet () species-in-mole-fractions yes q<br>/define/boundary-conditions/set/pressure-inlet inlet () mf no 1 q<br><br>/define/boundary-conditions/set/pressure-outlet outlet_x1 outlet_x2 outlet_y1 outlet_z1 outlet_z2 () t0 no 288.15 q<br><br>/define/boundary-conditions wall pipe 0 no 0 yes steel no no 0 no no no no no 0 no 0.5 yes no 1<br>/define/boundary-conditions wall ground 0 no 0 yes soil no no 0 no no no no no 0 no 0.5 yes no 1<br><br>; 9、创建并设置监测点和面<br>surf point-surf point-1 0 0.4 0 q<br>surf point-surf point-2 0 0.5 0 q<br>surf point-surf point-3 2 0.4 0 q<br><br>/solve/report-definitions add report1 surface-vertexavg field molef-h2 surface-names point-1 () q<br><br>/surface/plane plane1 0 0 0 0 1 0 0 0 1<br><br>; 10、初始化<br>/solve/initialize/set-defaults/ temperature 288.15<br>/solve/initialize/set-defaults/ pressure 0<br>/solve/initialize/set-defaults/ species-0 0<br><br>/solve/initialize initialize-flow ok<br>; 显示一下contour<br>;/display/contour molef-h2 0 1<br><br><br>; 11、设置保存格式及频率<br>; 设置数据保存内容<br>/file/data-file-options molef-h2 molef-air absolute-pressure air h2 velocity-magnitude mesh-x-velocity mesh-y-velocity mesh-z-velocity pressure density total-pressure total-temperature  x-velocity y-velocity z-velocity viscosity-eff viscosity-lam viscosity-ratio viscosity-turb vorticity-mag q<br>; 保存tecplot文件<br>/file/transient-export/tecplot  C:/Users/23984/Desktop/tui_test/tecplot1 ground inlet outlet_x1 outlet_x2 outlet_y1 outlet_z1 outlet_z2 pipe () molef-h2 molef-air absolute-pressure air h2 velocity-magnitude mesh-x-velocity mesh-y-velocity mesh-z-velocity pressure density total-pressure total-temperature  x-velocity y-velocity z-velocity viscosity-eff viscosity-lam viscosity-ratio viscosity-turb vorticity-mag q tecplot1 10 time-step<br><br>; 12、创建contour并保存动画<br>/display/objects/create contour &quot;contour-1&quot; filled yes field molef-h2 surfaces-list plane1 () q<br>/solve/animate/objects/create &quot;animation-1&quot; animate-on contour-1 storage-dir C:\Users\23984\Desktop\tui_test frequency-of &quot;Time Step&quot; q<br><br>; 13、设置迭代参数<br>/solve/set/max-iterations-per-time-step 50<br>/solve/set/time-step 1<br>/solve/set/number-of-time-steps 1000<br>/file/write-case/setting1.cas<br><br>; 14、开始计算<br>/solve/dual-time-iterate 1 2<br><br>exit ok<br></code></pre></td></tr></table></figure><h1 id="python-代码">Python 代码</h1><p>含注释</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment"># 获取python文件运行的目录文件夹</span><br>path, filename = os.path.split(os.path.abspath(__file__))<br><br><span class="hljs-comment"># 定义fluent.exe的目录</span><br>fluent_path = <span class="hljs-string">&quot;D:\\ANSYS18\\ANSYS Inc\\v180\\fluent\\ntbin\\win64&quot;</span><br><br><span class="hljs-comment"># 定义要运行的命令</span><br>command_list = []<br>command_list.append(<span class="hljs-string">f&#x27;&quot;<span class="hljs-subst">&#123;fluent_path&#125;</span>\\fluent.exe&quot; 3ddp -t4 -i jou1.jou&#x27;</span>)<br>command_list.append(<span class="hljs-string">f&#x27;&quot;<span class="hljs-subst">&#123;fluent_path&#125;</span>\\fluent.exe&quot; 3ddp -t4 -i jou2.jou&#x27;</span>)<br><br>time.sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># 定义fluent程序循环</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_fluent</span>(<span class="hljs-params">command,path</span>):<br>    process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, cwd=path, shell=<span class="hljs-literal">True</span>, universal_newlines=<span class="hljs-literal">True</span>)<br>    <span class="hljs-comment"># 持续监控输出，如果检测到程序结束就往下执行</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        output = process.stdout.readline()<br>        <span class="hljs-keyword">if</span> output == <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">and</span> process.poll() <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">if</span> output:<br>            <span class="hljs-built_in">print</span>(output.strip())<br>    rc = process.poll()<br><br>count = <span class="hljs-number">10</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,count):<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;开始循环第<span class="hljs-subst">&#123;i&#125;</span>个&quot;</span>)<br>  run_fluent(command_list[i],path)<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;第<span class="hljs-subst">&#123;i&#125;</span>个循环结束&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;程序结束&quot;</span>)<br></code></pre></td></tr></table></figure><blockquote><p>这里如果想使用 python算一些变量，然后传入程序中自动执行，这里提供一种方法，就是修改 tui文件（.jou）内的内容。</p></blockquote>]]></content>
    
    
    <summary type="html">基于python的subprocess线程库和TUI命令自动运行fluent算例</summary>
    
    
    
    <category term="模拟" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="Fluent" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/Fluent/"/>
    
    
    <category term="Fluent" scheme="http://example.com/tags/Fluent/"/>
    
    <category term="模拟" scheme="http://example.com/tags/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="Python" scheme="http://example.com/tags/Python/"/>
    
    <category term="学习笔记" scheme="http://example.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="TUI" scheme="http://example.com/tags/TUI/"/>
    
    <category term="自动化" scheme="http://example.com/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>TUI命令</title>
    <link href="http://example.com/2024/07/27/031%20Fleunt%20Tui%E5%91%BD%E4%BB%A4/"/>
    <id>http://example.com/2024/07/27/031%20Fleunt%20Tui%E5%91%BD%E4%BB%A4/</id>
    <published>2024-07-27T13:29:00.000Z</published>
    <updated>2025-02-08T06:47:20.944Z</updated>
    
    <content type="html"><![CDATA[<h1 id="tui-命令基本认识">1、TUI 命令基本认识</h1><p>Fluent 中的 Tui 命令能使 Fluent自动化操作，包括文件设置、案例读取、参数设置等功能。</p><h1 id="基本操作">2、基本操作</h1><p>在 Fluent 中的命令行可进行 tui 命令操作</p><ul><li>回车可查看命令提示；</li><li>q：返回上一级</li></ul><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/20240727213342.png" /></p><h1 id="案例">3、案例</h1><p>案例中包含注释</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs jou">; 1、读取网格文件<br>rc fluent.msh<br>mesh/check<br>mesh/quality<br><br><br>display mesh-outline<br><br>; 2、勾选瞬态<br>/define/models/unsteady-2nd-order yes<br><br>; 3、设置重力加速度<br>/define/operating-conditions/gravity yes 0 -9.81 0<br><br>; 4、开启能量方程<br>/define/models/energy y y y<br><br>; 5、湍流模型<br>/define/models/viscous/spalart-allmaras y<br><br>; 6、新增混合气体<br>/define/models/species/species-transport y hydrogen-air<br>/define/materials/change-create hydrogen-air hydrogen-air y 2 h2 air 0 0 n n n n n n<br><br>; 7、管道材料及土壤材料<br>/define/materials/copy/solid/steel<br>/define/materials/change-create aluminum soil y constant 2650 y constant 789 y constant 2.9 y<br><br>; 8、设置边界条件<br>/define/boundary-conditions/fluid solid fluid no no no no no  0 no 0 no 0 no  0 no 0 no 0 no no no no yes no no 1 no 0 no 0 no  0 no 1 no 0 yes no 245000000000 no 245000000000 no 245000000000 no no 502000 no 502000 no 502000 0 0 no 0.43 constant 1 yes no no no<br><br>/define/boundary-conditions/zone-type inlet pressure-inlet<br>/define/boundary-conditions/set/pressure-inlet inlet () p0 no 400000 q<br>/define/boundary-conditions/set/pressure-inlet inlet () supersonic/initial-gauge-pressure no 400000 q<br>/define/boundary-conditions/set/pressure-inlet inlet () ke-spec no no no yes q<br>/define/boundary-conditions/set/pressure-inlet inlet () turb-hydraulic-diam 0.01 q<br>/define/boundary-conditions/set/pressure-inlet inlet () t0 no 288.15 q<br>/define/boundary-conditions/set/pressure-inlet inlet () species-in-mole-fractions yes q<br>/define/boundary-conditions/set/pressure-inlet inlet () mf no 1 q<br><br>/define/boundary-conditions/set/pressure-outlet outlet_x1 outlet_x2 outlet_y1 outlet_z1 outlet_z2 () t0 no 288.15 q<br><br>/define/boundary-conditions wall pipe 0 no 0 yes steel no no 0 no no no no no 0 no 0.5 yes no 1<br>/define/boundary-conditions wall ground 0 no 0 yes soil no no 0 no no no no no 0 no 0.5 yes no 1<br><br>; 9、创建并设置监测点和面<br>surf point-surf point-1 0 0.4 0 q<br>surf point-surf point-2 0 0.5 0 q<br>surf point-surf point-3 2 0.4 0 q<br><br>/solve/report-definitions add report1 surface-vertexavg field molef-h2 surface-names point-1 () q<br><br>/surface/plane plane1 0 0 0 0 1 0 0 0 1<br><br>; 10、初始化<br>/solve/initialize/set-defaults/ temperature 288.15<br>/solve/initialize/set-defaults/ pressure 0<br>/solve/initialize/set-defaults/ species-0 0<br><br>/solve/initialize initialize-flow ok<br>; 显示一下contour<br>;/display/contour molef-h2 0 1<br><br><br>; 11、设置保存格式及频率<br>; 设置数据保存内容<br>/file/data-file-options molef-h2 molef-air absolute-pressure air h2 velocity-magnitude mesh-x-velocity mesh-y-velocity mesh-z-velocity pressure density total-pressure total-temperature  x-velocity y-velocity z-velocity viscosity-eff viscosity-lam viscosity-ratio viscosity-turb vorticity-mag q<br>; 保存tecplot文件<br>/file/transient-export/tecplot  C:/Users/23984/Desktop/tui_test/tecplot1 ground inlet outlet_x1 outlet_x2 outlet_y1 outlet_z1 outlet_z2 pipe () molef-h2 molef-air absolute-pressure air h2 velocity-magnitude mesh-x-velocity mesh-y-velocity mesh-z-velocity pressure density total-pressure total-temperature  x-velocity y-velocity z-velocity viscosity-eff viscosity-lam viscosity-ratio viscosity-turb vorticity-mag q tecplot1 10 time-step<br><br>; 12、创建contour并保存动画<br>/display/objects/create contour &quot;contour-1&quot; filled yes field molef-h2 surfaces-list plane1 () q<br>/solve/animate/objects/create &quot;animation-1&quot; animate-on contour-1 storage-dir C:\Users\23984\Desktop\tui_test frequency-of &quot;Time Step&quot; q<br><br>; 13、设置迭代参数<br>/solve/set/max-iterations-per-time-step 50<br>/solve/set/time-step 1<br>/solve/set/number-of-time-steps 1000<br>/file/write-case/setting.cas<br><br>; 14、开始计算<br>/solve/dual-time-iterate 1000 20<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">学习Fluent的TUI命令基础知识以及如何自己写TUI</summary>
    
    
    
    <category term="模拟" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="Fluent" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/Fluent/"/>
    
    
    <category term="Fluent" scheme="http://example.com/tags/Fluent/"/>
    
    <category term="模拟" scheme="http://example.com/tags/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="学习笔记" scheme="http://example.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="TUI" scheme="http://example.com/tags/TUI/"/>
    
  </entry>
  
  <entry>
    <title>库朗数</title>
    <link href="http://example.com/2024/07/26/030%20%E5%BA%93%E6%9C%97%E6%95%B0/"/>
    <id>http://example.com/2024/07/26/030%20%E5%BA%93%E6%9C%97%E6%95%B0/</id>
    <published>2024-07-26T11:34:00.000Z</published>
    <updated>2025-02-08T06:47:20.943Z</updated>
    
    <content type="html"><![CDATA[<h1 id="时间步长的确定">时间步长的确定</h1><p>https://blog.csdn.net/staywithmoon/article/details/124253642</p><p>https://blog.csdn.net/weixin_45560646/article/details/126922667</p><p>https://www.youtube.com/watch?v=WBWY46ynRk0</p><h2 id="库朗数">1、库朗数</h2><h3 id="基本概念">1.1 基本概念</h3><p>库朗数是用来衡量数值计算稳定性的一个物理量，也被称为<code>CFL</code>数、<code>CFL</code>准则。</p><p><span class="math display">\[Courant=\frac{u\Delta t}{\Deltax}\]</span></p><p>u 为流体速度；Δt 为时间步长；Δx 为网格尺寸；</p><blockquote><p><code>u*Δt</code>表示流体在 Δt时间内流动的距离，除以网格尺寸，则表示流体在一个时间步长内流过了多少个网格。</p></blockquote><p>一般取值在<strong>1~10</strong>之间比较合适，当然要根据实际情况，如收敛性比较差，可适当降低这个数值。收敛性比较好，收敛速度慢，可适当增加库朗数。Fluent帮助文档认为对于大多数问题，库朗数设置为 1 能够满足要求。</p><p>实际上，Fluent 很多案例的库朗数都是50，这主要是选择了隐式算法的原因</p><h3 id="库朗数的设置">1.2 <strong>库朗数的设置</strong></h3><ul><li>显示格式 Explicit Formulation：默认是 1，对于 2维问题可适当增加库朗数，但不要超过2.0。如果设置没有问题，但是计算发散了，或者残差上升得非常快，就必须降低Courant number，可能需要降低到 0.5，甚至0.1。但如果收敛性很好，就可以增加 Courant number。</li><li>隐式格式 Implicit Formulation：默认库朗数为 5.0。通常可以 增加到10、20、100 甚至更高。与显示一样可根据收敛情况进行更改。</li></ul><blockquote><p>对于隐式非定常格式：对于不可压流动，在每个时间步内，不可压解必须迭代直至收敛。</p><p>对于显式非定常格式：每一个迭代就是一个时间步</p></blockquote><p>每个时间步内结果没有得到收敛，则很有可能你所得到的结果是不真实的</p><h3 id="库朗数推荐">1.3 库朗数推荐</h3><ul><li>Large Eddy Simulation(0.5-1)</li><li>Free Surface Flows(&lt;1)</li><li>Compressible Flows(depends on speed of sound)</li><li>Turbomachinery(&lt;80)</li><li>Explicit Time Stepping(&lt;1)</li></ul>]]></content>
    
    
    <summary type="html">库朗数基本介绍及推荐值</summary>
    
    
    
    <category term="模拟" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="Fluent" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/Fluent/"/>
    
    
    <category term="Fluent" scheme="http://example.com/tags/Fluent/"/>
    
    <category term="模拟" scheme="http://example.com/tags/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="学习笔记" scheme="http://example.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="库朗数" scheme="http://example.com/tags/%E5%BA%93%E6%9C%97%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>DPM颗粒模型</title>
    <link href="http://example.com/2024/07/26/029%20Fluent%20DPM%E6%A8%A1%E5%9E%8B/"/>
    <id>http://example.com/2024/07/26/029%20Fluent%20DPM%E6%A8%A1%E5%9E%8B/</id>
    <published>2024-07-26T11:33:00.000Z</published>
    <updated>2025-02-08T06:47:20.943Z</updated>
    
    <content type="html"><![CDATA[<h1 id="学习笔记">1 学习笔记</h1><h2 id="fluent-颗粒流">0、Fluent 颗粒流</h2><p>Fluent 有 3 种颗粒模拟方法</p><ol type="1"><li>欧拉颗粒流（双流体模型）：把颗粒当做连续介质处理，优点是计算量小，但需要更多的相互作用模型，比如阻力等，多用于流化床。</li><li>DPM 模型（离散相模型）：DPM模型之间不考虑碰撞也不考虑体积空间，适用于流体占主导作用的，颗粒占比不超过10%。模拟一般灰尘、气溶胶等小颗粒的运动，也经常配合化学反应。</li><li>DDPM 模型（稠密离散相模型）：DDPM 是 Dense Discrete Phase Model的缩写，是专门用来模拟例如流化床这种稠密颗粒流的模型，可以理解为简化了的DEM。他和 DPM的区别就是考虑了<strong>体积分数</strong>，是有孔隙率的，后处理中能够查看颗粒所占的体积分数，在相间相互作用力也可以考虑颗粒之间的碰撞，但是对于碰撞的计算是进行了模化的，不是用软球模型计算真实的碰撞过程，颗粒间的碰撞产生的力是根据KTGF 下颗粒的 stress tensori 计算得到。</li><li>DEM 离散元模型：可考虑颗粒的真实碰撞，可采用弹性 弹性阻尼 赫兹赫兹阻尼碰撞模型，一般 DDPM+DEM 一起使用</li></ol><h2 id="耦合">1、耦合</h2><ol type="1"><li>单向耦合</li><li>双向耦合</li></ol><h3 id="单向耦合">1.1 单向耦合</h3><p>单向耦合：离散相对连续相影响很小无需设置相间耦合.</p><p>单向耦合问题：只要在加入离散相粒子前计算连续相流场直至收敛，然后打开离散相模型，加入离散相粒子，无需迭代计算因为已经计算收敛流场稳定了.</p><p>连续相（也就是流场）计算可以是 steady（定常/稳态流场）也可以是unsteady（非定常/瞬态/transient）。这两种连续相的流场中离散相计算都可以用非耦合粒子计算。</p><p>单相耦合计算不考虑离散相对连续相的影响，离散相的动量、质量、温度等信息不会反馈给流场，因为流场事先已经计算收敛了，不能变了，当开DPM 时候，就是通过流场的信息计算 DPM 了，简单说是流场产生 DPM场的概念。</p><h3 id="双向耦合">1.2 双向耦合</h3><p>耦合计算的步骤：</p><ol type="1"><li>求解连续相流场（在引入离散相之前））</li><li>通过计算每个离散相注入的粒子轨迹来引入离散相。</li><li>使用先前粒子计算期间确定的动量、热量和质量的相间交换，重新计算连续相流。</li><li>重新计算修改的连续相流场中的离散相轨迹。</li><li>重复前两个步骤，直到获得收敛解，其中连续相流场和离散相颗粒轨迹在每次附加计算中都保持不变。</li></ol><h2 id="dpm-边界条件">2、DPM 边界条件</h2><ol type="1"><li>escape 逃逸：颗粒离开流体域</li><li>trap：被捕获吸收</li><li>reflect：反弹，一般用于壁面上，需要指定反射系数</li><li>wall jet：壁面射流，颗粒触碰壁面后会分成更小的颗粒继续流动</li><li>wall film：需要打开壁面液膜模型，与 wall jet 相似</li><li>reinject：当颗粒达到某个计算域边界时，将粒子重新引入域。</li></ol><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291658664.png"alt="image-20230829165815567" /><figcaption aria-hidden="true">image-20230829165815567</figcaption></figure><h2 id="粒子方向">3、粒子方向</h2><p>Inject Using Face NormalDirection：开启这个选项后，粒子在入射时的速度方向将与面法向一致，这样就无需定义颗粒在x、y、z 三个方向的速度分量，只需要定义速度值； <imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202309020913147.png"alt="image.png" /></p><h2 id="粒子射入类型">4、粒子射入类型</h2><p>https://zhuanlan.zhihu.com/p/532180420 <imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202309020914955.png"alt="image.png" /></p><h2 id="颗粒碰撞">5、颗粒碰撞</h2><p>https://zhuanlan.zhihu.com/p/621078742</p><h2 id="颗粒其他作用">6、颗粒其他作用</h2><h1 id="案例颗粒搅拌">2 案例：颗粒搅拌</h1><h2 id="重力项">1、重力项</h2><h2 id="离散相模型">2、离散相模型</h2><p>打开【交互】-【与连续相的交互】</p><ul><li>每次流动迭代更新 DPM 源项：意思是每 10个流动迭代更新一下颗粒的数量变化，这个都给他勾选上，颗粒破碎，被壁面捕获，更改质量流量都会使数量发生变化。</li><li>DPM 迭代间隔：连续相每次迭代 10步，开始进行离散相的计算。（不收敛可调小）</li><li>颗粒时时间步大小：如为 0.001s 代表颗粒相每 0.001s追踪一次，但是，在开始计算阶段，粒子一边释放一边追踪，释放完成后也在追踪。（不收敛可调小）</li><li>最大步数和步长因子：Max number of steps 和 Specify LengthScale，每一次轨迹跟踪的最大积分时间步数和积分长度标尺，都是为了确定积分时间步长∆t。选择 Specify Length Scale选项以确定积分时间步长时，积分时间步长约等于所给的长度尺度（LengthScale）除以颗粒相对于连续相的速度大小。而积分步数约等于颗粒时间步长（ParticleTime Step Size）除以积分时间步长，但以 Max Number of Steps为限（因此：积分时间步长 ∆t&lt;颗粒时间步长 Particle Time StepSize∆tp）。所以，如 Max Number of Steps不够大，则未到颗粒时间步长就结束一个颗粒时间步，并转入下一个颗粒时间步，因而颗粒终了状态报告为incomplete。</li></ul><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291040314.png"alt="image-20230829104022213" /><figcaption aria-hidden="true">image-20230829104022213</figcaption></figure><p>设置喷射源</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291041115.png"alt="image-20230829104130041" /><figcaption aria-hidden="true">image-20230829104130041</figcaption></figure><h2 id="追踪颗粒轨迹">3、追踪颗粒轨迹</h2><p>创建颗粒轨迹</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291541393.png"alt="image-20230829154138243" /><figcaption aria-hidden="true">image-20230829154138243</figcaption></figure><p>创建颗粒场景并保存</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291542031.png"alt="image-20230829154239921" /><figcaption aria-hidden="true">image-20230829154239921</figcaption></figure><p>创建解决方案动画</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291543657.png"alt="image-20230829154309557" /><figcaption aria-hidden="true">image-20230829154309557</figcaption></figure><h2 id="导出颗粒数据">4、导出颗粒数据</h2><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291543784.png"alt="image-20230829154336663" /><figcaption aria-hidden="true">image-20230829154336663</figcaption></figure><h1 id="喷头模拟">3 喷头模拟</h1><h2 id="碳酸氢钠性质">碳酸氢钠性质</h2><p>密度：2.16 g/mL 直径：在 0.1-10mm 之间</p><h2 id="section">20230829</h2><p>使用之前的网格，只有喷嘴和场域，出口 5MPa 和出口 2MPa 都发散。想到昨天尝试的将出口都改为压力出口（包括计算域的edge）计算较好，今天再试一下，但还是发散。使用昨天的设置再跑一边，只不过加入离散相。但是昨天加入了 VOF模型，现在关闭了。 <strong>成功设置</strong> 1、瞬态 2、能量 3、标准k-e，标准壁面 4、离散相模型： <imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291913883.png"alt="image.png" /> 直径 0.0001，温度 300K，停止时间 1e-5，总流量 100000<imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291913817.png"alt="image.png" /> 5、材料 <imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291914553.png"alt="image.png" /> 6、边界条件 <imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291915645.png"alt="image.png" /> 压力进口（ecapse） <imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291916777.png"alt="image.png" /> 压力出口 edge（reflect） <imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291916237.png"alt="image.png" /> <imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291917062.png"alt="image.png" /> 7、方法 PISO 方法 <imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202308291917948.png"alt="image.png" /> 8、残差 1e-06 9、步长 时间步长 0.01 时间步数 100</p><h2 id="section-1">20230905</h2><p>截止今日，在雪研师姐电脑上已经模拟完成渐扩喷头 2MPa 和5MPa，在自己电脑上渐扩喷头（带孔）2MPa，步长 1e-6，共 1000步。但是模拟出的粒子速度太大，现在想要使用 udf改变压力边界条件，呈现一个递减的趋势，气体使用真实气体状态方程进行模拟，密度基求解器。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;udf.h&quot;</span></span><br>DEFINE_PROFILE(inlet_x,thread,index)<br>&#123;<br>real y,v0,h0;<br>real x[ND_ND];<br><span class="hljs-type">face_t</span> f;<br>real flow_time = CURRENT_TIME;  <span class="hljs-comment">// 获取当前模拟的时间</span><br>begin_f_loop(f,thread)<br>&#123;<br><span class="hljs-keyword">if</span>(flow_time &gt;=<span class="hljs-number">0</span> &amp;&amp; flow_time &lt;= <span class="hljs-number">0.05</span> )<br>F_PROFILE(f,thread,index) = <span class="hljs-number">2000000</span> - <span class="hljs-number">40000000</span> * flow_time;<br><span class="hljs-keyword">else</span><br>F_PROFILE(f,thread,index) = <span class="hljs-number">0</span>;<br>&#125;<br>end_f_loop(f,thread)<br>&#125;<br></code></pre></td></tr></table></figure><p>为了能使粒子喷出后分散均匀，共设计 6种喷头结构，分别为渐扩喷头、渐扩喷头（带孔）、拉法尔喷头、拉法尔喷头（带孔）、蘑菇喷头和蘑菇喷头（带孔）。喷嘴尺寸：</p><p>喷嘴网格：</p><h3 id="空气">空气</h3><p>使用高压空气作为驱动气充入喷粉罐中，空气携带粒子以 2MPa 和 5MPa的压力喷出。压力以 40MPa/s 速度衰减，在 50ms 时衰减为 0。使用理想气体，密度变化。</p><h3 id="粒子">粒子</h3><p>抑爆剂粒子选用 NaHCO3 粒子，密度为 2.16g/cm³，比热为 2170J/(kg K)粒子的直径分布在 1~100um 范围内，平均直径为 50um，共 10 种粒子大小。粒子总质量 100g，在 50ms 内喷完。即产生速率为 2kg/s。（假设阀门 50ms打开） 粒子速度为 0.1m/s 从壁面出来 双向耦合，考虑粒子的碰撞</p><h3 id="求解器设置">求解器设置：</h3><p>因喷出速度较大，求解器选用密度基。</p>]]></content>
    
    
    <summary type="html">对Fluent中的DPM模型基本介绍，模拟固体颗粒通过喷头喷出的效果</summary>
    
    
    
    <category term="模拟" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="Fluent" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/Fluent/"/>
    
    
    <category term="Fluent" scheme="http://example.com/tags/Fluent/"/>
    
    <category term="模拟" scheme="http://example.com/tags/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="学习笔记" scheme="http://example.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="DPM" scheme="http://example.com/tags/DPM/"/>
    
  </entry>
  
  <entry>
    <title>深度学习入门</title>
    <link href="http://example.com/2024/06/30/028%20%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8/"/>
    <id>http://example.com/2024/06/30/028%20%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8/</id>
    <published>2024-06-30T14:45:00.000Z</published>
    <updated>2025-02-08T07:10:13.931Z</updated>
    
    <content type="html"><![CDATA[<h1 id="基本配置">基本配置</h1><p><ahref="https://github.com/baiqinglun/pytorch_learning.git">github</a></p><p><ahref="https://www.bilibili.com/video/BV1Z8411R7PH/?spm_id_from=333.788&amp;vd_source=33b50a4dd201d7564e6e63d321809ce9">学习视频地址</a></p><h2 id="环境配置">环境配置</h2><ol type="1"><li>在 anaconda中新建虚拟环境<code>conda create -n Pytorch python=3.9</code></li><li>激活虚拟环境并安装 numpy、matplotlib、pandas 库</li><li>在终端命令行输入：<code>nvidia-smi</code>查看 CUNDA 版本，在安装pytorch 时需要注意版本：CONDA &gt; conda</li></ol><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406301747100.png" /></p><h2 id="更改-jupyter-默认打开目录">更改 jupyter 默认打开目录</h2><ol type="1"><li>首先使用以下命令生成 jupyter配置文件，生成的文件一般在<code>C:\Users\用户名\.jupyter</code>文件夹内</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">jupyter notebook --generate-config<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li><p>查找该文件中的<code>c.NotebookApp.notebook_dir</code>更改为<code>c.NotebookApp.notebook_dir = 'F:\Jupyter'</code>并保存，此时默认路径就更改为<code>'F:\Jupyter'</code></p></li><li><p>修改 jupyter快捷方式的打开方式，删除后面的环境变量，至此修改成功。</p></li></ol><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406301822505.png" /></p><h2 id="将-conda-虚拟环境关联至-jupyter">将 conda 虚拟环境关联至jupyter</h2><p>安装 ipykernel</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda activate pytorch<br>pip install ipykernel<br></code></pre></td></tr></table></figure><p>导入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -m ipykernel install --user --name=pytorch<br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406301827885.png" /></p><h2 id="测试-conda-是否可用">测试 conda 是否可用</h2><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406301828813.png" /></p><h1 id="dnn-基本原理">2、DNN 基本原理</h1><p>主要可分为以下 4 个步骤：</p><ol type="1"><li>划分数据集</li><li>训练网络</li><li>测试网络</li><li>使用网络</li></ol><h2 id="划分数据集">2.1 划分数据集</h2><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406301841002.png" /></p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406301841606.png"alt="神经网络的结构" /><figcaption aria-hidden="true">神经网络的结构</figcaption></figure><p>考虑到 Python 列表、NumPy 数组以及 PyTorch张量都是从索引[0]开始，再加之输入层没有内部参数（权重 ω 与偏置b），所以习惯将输入层称之为第 0 层。</p><h2 id="训练网络">2.2 训练网络</h2><p>神经网络的训练过程，就是经过很多次前向传播与反向传播的轮回，最终不断调整其内部参数（权重ω 与偏置 b），以拟合任意复杂函数的过程。内部参数一开始是随机的（如Xavier 初始值、He 初始值），最终会不断优化到最佳。</p><p>习惯把内部参数称为参数，外部参数称为超参数。</p><p>（1）前向传播</p><p>将单个样本的 3个输入特征送入神经网络的输入层后，神经网络会逐层计算到输出层，最终得到神经网络预测的3 个输出特征。</p><p>该神经元节点的计算过程为<spanclass="math inline">\(y=\omega_1x_1+\omega_2x_2+\omega_3x_3+b\)</span>。你可以理解为，每一根线就是一个权重 ω，每一个神经元节点也都有它自己的偏置b。当然，每个神经元节点在计算完后，由于这个方程是线性的，因此必须在外面套一个非线性的函数：<spanclass="math inline">\(y=\sigma\left(\omega_1x_1+\omega_2x_2+\omega_3x_3+b\right)\)</span>，σ 被称为激活函数。<strong>如果你不套非线性函数，那么即使 10层的网络，也可以用 1 层就拟合出同样的方程。</strong></p><p>（2）反向传播</p><p>经过前向传播，网络会根据当前的内部参数计算出输出特征的预测值。为计算预测值与真实值之间的差距，需要一个损失函数。</p><p>损失函数计算好后，逐层退回求梯度。即看每一个内部参数是变大还是变小，才会使得损失函数变小。这样就达到了优化内部参数的目的。</p><p>关键参数：外部参数叫学习率。学习率越大，内部参数的优化越快，但过大的学习率可能会使损失函数越过最低点，并在谷底反复横跳。</p><p>（3）batch_size</p><p>前向传播与反向传播一次时，有三种情况：</p><ul><li>批量梯度下降（Batch GradientDescent，BGD），把所有样本一次性输入进网络，这种方式计算量开销很大，速度也很慢。</li><li>随机梯度下降（Stochastic GradientDescent，SGD），每次只把一个样本输入进网络，每计算一个样本就更新参数。这种方式虽然速度比较快，但是收敛性能差，可能会在最优点附近震荡，两次参数的更新也有可能抵消。</li><li>小批量梯度下降（Mini-Batch GradientDecent，MBGD）是为了中和上面二者而生，这种办法把样本划分为若干个批，按批来更新参数。</li></ul><blockquote><p>PyTorch 只支持批量与小批量</p></blockquote><p>（4）epochs</p><p>1 个 epoch 就是指全部样本进行 1 次前向传播与反向传播。</p><p>假设有 10240 个训练样本，batch_size 是 1024，epochs 是 5。那么：</p><ul><li>全部样本将进行 5 次前向传播与反向传播；</li><li>1 个 epoch，将发生 10 次（10240x1024）前向传播与反向传播；</li><li>一共发生 50 次（105）前向传播和反向传播。</li></ul><h2 id="测试网络">2.3 测试网络</h2><p>目的：防止过拟合。过拟合：网络优化好的内部参数支队本训练样本有效。</p><p>测试集时，只需要一次前向传播。</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406301948453.png" /></p><h2 id="使用网络">2.4 使用网络</h2><p>直接将样本进行 1 次前向传播。</p><h1 id="dnn-的实现">3、DNN 的实现</h1><h2 id="制作数据集">3.1 制作数据集</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-comment"># 展示高清图</span><br><span class="hljs-keyword">from</span> matplotlib_inline <span class="hljs-keyword">import</span> backend_inline<br>backend_inline.set_matplotlib_formats(<span class="hljs-string">&#x27;svg&#x27;</span>)<br><br>X1 = torch.rand(<span class="hljs-number">10000</span>,<span class="hljs-number">1</span>) <span class="hljs-comment"># 输入特征1</span><br>X2 = torch.rand(<span class="hljs-number">10000</span>,<span class="hljs-number">1</span>) <span class="hljs-comment"># 输入特征2</span><br>X3 = torch.rand(<span class="hljs-number">10000</span>,<span class="hljs-number">1</span>) <span class="hljs-comment"># 输入特征3</span><br><br>Y1 = ( (X1+X2+X3)&lt;<span class="hljs-number">1</span> ).<span class="hljs-built_in">float</span>() <span class="hljs-comment"># 输出特征1</span><br>Y2 = ( (<span class="hljs-number">1</span>&lt;(X1+X2+X3)) &amp; ((X1+X2+X3)&lt;<span class="hljs-number">2</span>) ).<span class="hljs-built_in">float</span>() <span class="hljs-comment"># 输出特征2</span><br>Y3 = ( (X1+X2+X3)&gt;<span class="hljs-number">2</span> ).<span class="hljs-built_in">float</span>() <span class="hljs-comment"># 输出特征3</span><br>Data = torch.cat([X1,X2,X3,Y1,Y2,Y3],axis=<span class="hljs-number">1</span>) <span class="hljs-comment"># 整合数据集</span><br>Data = Data.to(<span class="hljs-string">&#x27;cuda:0&#x27;</span>) <span class="hljs-comment"># 把数据集搬到GPU 上</span><br><br><span class="hljs-comment"># 划分训练集与测试集</span><br>train_size = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(Data) * <span class="hljs-number">0.7</span>) <span class="hljs-comment"># 训练集的样本数量</span><br>test_size = <span class="hljs-built_in">len</span>(Data) - train_size <span class="hljs-comment"># 测试集的样本数量</span><br>Data = Data[torch.randperm( Data.size(<span class="hljs-number">0</span>)) , : ] <span class="hljs-comment"># 打乱样本的顺序</span><br>train_Data = Data[ : train_size , : ] <span class="hljs-comment"># 训练集样本</span><br>test_Data = Data[ train_size : , : ] <span class="hljs-comment"># 测试集样本</span><br>train_Data.shape, test_Data.shape<br></code></pre></td></tr></table></figure><h2 id="搭建神经网络">3.2 搭建神经网络</h2><p>通常以 nn.Module作为父类，自己的神经网络可直接继承父类的方法和属性。</p><p>在定义神经网络时通常需要包含 2个方法，<code>__init__</code>和<code>forward</code></p><ul><li><code>__init__</code>：用于构建自己的神经网络</li><li><code>forward</code>：用于输入数据进行向前传播</li></ul><p><strong>（1）搭建神经网络结构</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DNN</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27; 搭建神经网络各层 &#x27;&#x27;&#x27;</span><br>        <span class="hljs-built_in">super</span>(DNN,self).__init__()<br>        self.net = nn.Sequential( <span class="hljs-comment"># 按顺序搭建各层</span><br>            nn.Linear(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>), nn.ReLU(), <span class="hljs-comment"># 第1 层：全连接层</span><br>            nn.Linear(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>), nn.ReLU(), <span class="hljs-comment"># 第2 层：全连接层</span><br>            nn.Linear(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>), nn.ReLU(), <span class="hljs-comment"># 第3 层：全连接层</span><br>            nn.Linear(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>) <span class="hljs-comment"># 第4 层：全连接层</span><br>        )<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27; 前向传播 &#x27;&#x27;&#x27;</span><br>        y = self.net(x) <span class="hljs-comment"># x 即输入数据</span><br>        <span class="hljs-keyword">return</span> y <span class="hljs-comment"># y 即输出数据</span><br></code></pre></td></tr></table></figure><p><strong>代码解析</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">nn.Linear(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>), nn.ReLU()<br></code></pre></td></tr></table></figure><ul><li>表示一个隐藏层，第一个隐藏层为线性层，搜嘎会给你一个神经元节点数是3，这层节点数是 5</li><li>后面的<code>nn.ReLU()</code>表示一个激活函数</li></ul><p><strong>代码解析</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">nn.Linear(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>), nn.ReLU(), <span class="hljs-comment"># 第1 层：全连接层</span><br>nn.Linear(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>), nn.ReLU(), <span class="hljs-comment"># 第2 层：全连接层</span><br>nn.Linear(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>), nn.ReLU(), <span class="hljs-comment"># 第3 层：全连接层</span><br>nn.Linear(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>) <span class="hljs-comment"># 第4 层：全连接层</span><br></code></pre></td></tr></table></figure><p>第二层的第一个数要和第一层的第二个数对应</p><p><strong>（2）创建神经网络</strong></p><p>创建 model 实例，并将其转移掉 gpu 上</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406302117031.png" /></p><ul><li>每个隐藏层都有一个激活函数。</li><li>各层的神经元节点数位 3 5 5 5 3</li></ul><blockquote><p>输入层的神经元数量必须与每个样本的输入特征数量一致，输出层的神经数量必须与每个样本的输出特征数量一致。</p></blockquote><h2 id="网络的内部参数">3.3 网络的内部参数</h2><p>权重与偏置</p><p>查看网络内部参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> name,param <span class="hljs-keyword">in</span> model.named_parameters():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;参数:<span class="hljs-subst">&#123;name&#125;</span>\n形状:<span class="hljs-subst">&#123;param.shape&#125;</span>\n数值:<span class="hljs-subst">&#123;param&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406302123628.png" /></p><ul><li>net.0.weight 权重形状为[5,3]，5 表示自己的节点数，3表示前一层的节点数</li><li><code>device='cuda:0'</code>表示在 gpu 上</li><li><code>requires_grad=True</code>表示打开梯度计算功能</li></ul><h2 id="网络外部参数">3.4 网络外部参数</h2><p>又叫超参数。</p><ul><li>搭建网络时的超参数：网络的层数、各隐藏层节点数、各节点激活函数、内部参数的初始值等。</li><li>训练网络时的超参数：损失函数、学习率、优化算法、batch_size、epochs等。</li></ul><p><strong>（1）激活函数</strong></p><p>引入非线性因素，从而使神经网络能够学习和表达更加复杂的函数关系。</p><p><ahref="https://pytorch.org/docs/2.3/nn.html#non-linear-activations-weighted-sum-nonlinearity">官网</a></p><p>https://cloud.tencent.com/developer/article/1797190</p><p><strong>（2）损失函数</strong></p><p>计算神经网络每次迭代的前向计算结果与真实值的差距，从而指导下一步的训练向正确的方向进行。</p><p><a href="https://pytorch.org/docs/2.3/optim.html">官网</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 损失函数的选择</span><br>loss_fn = nn.MSELoss()<br><br><span class="hljs-comment"># 优化算法的选择</span><br>learning_rate = <span class="hljs-number">0.01</span> <span class="hljs-comment"># 设置学习率</span><br>optimizer = torch.optim.SGD(model.parameters(), lr=learning_rate)<br></code></pre></td></tr></table></figure><h2 id="训练网路">3.5 训练网路</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 训练网络</span><br>epochs = <span class="hljs-number">1000</span><br>losses = [] <span class="hljs-comment"># 记录损失函数变化的列表</span><br><span class="hljs-comment"># 给训练集划分输入与输出</span><br>X = train_Data[ : , :<span class="hljs-number">3</span> ] <span class="hljs-comment"># 前3 列为输入特征</span><br>Y = train_Data[ : , -<span class="hljs-number">3</span>: ] <span class="hljs-comment"># 后3 列为输出特征</span><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>    Pred = model(X) <span class="hljs-comment"># 一次前向传播（批量）</span><br>    loss = loss_fn(Pred, Y) <span class="hljs-comment"># 计算损失函数</span><br>    losses.append(loss.item()) <span class="hljs-comment"># 记录损失函数的变化</span><br>    optimizer.zero_grad() <span class="hljs-comment"># 清理上一轮滞留的梯度</span><br>    loss.backward() <span class="hljs-comment"># 一次反向传播</span><br>    optimizer.step() <span class="hljs-comment"># 优化内部参数</span><br>Fig = plt.figure()<br>plt.plot(<span class="hljs-built_in">range</span>(epochs), losses)<br>plt.ylabel(<span class="hljs-string">&#x27;loss&#x27;</span>), plt.xlabel(<span class="hljs-string">&#x27;epoch&#x27;</span>)<br>plt.show()<br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406302139653.png" /></p><h2 id="测试神网络">3.6 测试神网络</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 测试网络</span><br><span class="hljs-comment"># 给测试集划分输入与输出</span><br>X = test_Data[:, :<span class="hljs-number">3</span>] <span class="hljs-comment"># 前3 列为输入特征</span><br>Y = test_Data[:, -<span class="hljs-number">3</span>:] <span class="hljs-comment"># 后3 列为输出特征</span><br><span class="hljs-keyword">with</span> torch.no_grad(): <span class="hljs-comment"># 该局部关闭梯度计算功能</span><br>    Pred = model(X) <span class="hljs-comment"># 一次前向传播（批量）</span><br>    Pred[:,torch.argmax(Pred, axis=<span class="hljs-number">1</span>)] = <span class="hljs-number">1</span><br>    Pred[Pred!=<span class="hljs-number">1</span>] = <span class="hljs-number">0</span><br>    correct = torch.<span class="hljs-built_in">sum</span>( (Pred == Y).<span class="hljs-built_in">all</span>(<span class="hljs-number">1</span>) ) <span class="hljs-comment"># 预测正确的样本</span><br>    total = Y.size(<span class="hljs-number">0</span>) <span class="hljs-comment"># 全部的样本数量</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;测试集精准度: <span class="hljs-subst">&#123;<span class="hljs-number">100</span>*correct/total&#125;</span> %&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="保存与导入网络">3.7 保存与导入网络</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 保存网络</span><br>torch.save(model,<span class="hljs-string">&#x27;model.pth&#x27;</span>)<br><br><span class="hljs-comment"># 导入网络</span><br>new_model =torch.load(<span class="hljs-string">&#x27;model.pth&#x27;</span>)<br><br><span class="hljs-comment"># 测试新网络</span><br><span class="hljs-comment"># 给测试集划分输入与输出</span><br>X = test_Data[:, :<span class="hljs-number">3</span>] <span class="hljs-comment"># 前3 列为输入特征</span><br>Y = test_Data[:, -<span class="hljs-number">3</span>:] <span class="hljs-comment"># 后3 列为输出特征</span><br><span class="hljs-keyword">with</span> torch.no_grad(): <span class="hljs-comment"># 该局部关闭梯度计算功能</span><br>    Pred = new_model(X) <span class="hljs-comment"># 用新模型进行一次前向传播</span><br>    Pred[:,torch.argmax(Pred, axis=<span class="hljs-number">1</span>)] = <span class="hljs-number">1</span><br>    Pred[Pred!=<span class="hljs-number">1</span>] = <span class="hljs-number">0</span><br>    correct = torch.<span class="hljs-built_in">sum</span>( (Pred == Y).<span class="hljs-built_in">all</span>(<span class="hljs-number">1</span>) ) <span class="hljs-comment"># 预测正确的样本</span><br>    total = Y.size(<span class="hljs-number">0</span>) <span class="hljs-comment"># 全部的样本数量</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;测试集精准度: <span class="hljs-subst">&#123;<span class="hljs-number">100</span>*correct/total&#125;</span> %&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="批量梯度下降案例代码">4、批量梯度下降案例代码</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-comment"># 展示高清图</span><br><span class="hljs-keyword">from</span> matplotlib_inline <span class="hljs-keyword">import</span> backend_inline<br>backend_inline.set_matplotlib_formats(<span class="hljs-string">&#x27;svg&#x27;</span>)<br><br><span class="hljs-comment"># 准备数据集</span><br>df = pd.read_csv(<span class="hljs-string">&#x27;Data.csv&#x27;</span>, index_col=<span class="hljs-number">0</span>) <span class="hljs-comment"># 导入数据</span><br>arr = df.values <span class="hljs-comment"># Pandas 对象退化为NumPy 数组</span><br>arr = arr.astype(np.float32) <span class="hljs-comment"># 转为float32 类型数组</span><br>ts = torch.tensor(arr) <span class="hljs-comment"># 数组转为张量</span><br>ts = ts.to(<span class="hljs-string">&#x27;cuda&#x27;</span>) <span class="hljs-comment"># 把训练集搬到cuda 上</span><br><br><span class="hljs-comment"># 划分训练集与测试集</span><br>train_size = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(ts) * <span class="hljs-number">0.7</span>) <span class="hljs-comment"># 训练集的样本数量</span><br>test_size = <span class="hljs-built_in">len</span>(ts) - train_size <span class="hljs-comment"># 测试集的样本数量</span><br>ts = ts[ torch.randperm( ts.size(<span class="hljs-number">0</span>) ) , : ] <span class="hljs-comment"># 打乱样本的顺序</span><br>train_Data = ts[ : train_size , : ] <span class="hljs-comment"># 训练集样本</span><br>test_Data = ts[ train_size : , : ] <span class="hljs-comment"># 测试集样本</span><br><br><span class="hljs-comment"># 创建神经网络</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DNN</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27; 搭建神经网络各层 &#x27;&#x27;&#x27;</span><br>        <span class="hljs-built_in">super</span>(DNN,self).__init__()<br>        self.net = nn.Sequential( <span class="hljs-comment"># 按顺序搭建各层</span><br>        nn.Linear(<span class="hljs-number">8</span>, <span class="hljs-number">32</span>), nn.Sigmoid(), <span class="hljs-comment"># 第1 层：全连接层</span><br>        nn.Linear(<span class="hljs-number">32</span>, <span class="hljs-number">8</span>), nn.Sigmoid(), <span class="hljs-comment"># 第2 层：全连接层</span><br>        nn.Linear(<span class="hljs-number">8</span>, <span class="hljs-number">4</span>), nn.Sigmoid(), <span class="hljs-comment"># 第3 层：全连接层</span><br>        nn.Linear(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>), nn.Sigmoid() <span class="hljs-comment"># 第4 层：全连接层</span><br>        )<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27; 前向传播 &#x27;&#x27;&#x27;</span><br>        y = self.net(x) <span class="hljs-comment"># x 即输入数据</span><br>        <span class="hljs-keyword">return</span> y <span class="hljs-comment"># y 即输出数据</span><br><br>model = DNN().to(<span class="hljs-string">&#x27;cuda:0&#x27;</span>) <span class="hljs-comment"># 创建子类的实例，并搬到GPU 上</span><br><br><span class="hljs-comment"># 损失函数的选择</span><br>loss_fn = nn.BCELoss(reduction=<span class="hljs-string">&#x27;mean&#x27;</span>)<br><br><span class="hljs-comment"># 优化算法的选择</span><br>learning_rate = <span class="hljs-number">0.005</span> <span class="hljs-comment"># 设置学习率</span><br>optimizer = torch.optim.Adam(model.parameters(), lr=learning_rate)<br><br><span class="hljs-comment"># 训练网络</span><br>epochs = <span class="hljs-number">5000</span><br>losses = [] <span class="hljs-comment"># 记录损失函数变化的列表</span><br><span class="hljs-comment"># 给训练集划分输入与输出</span><br>X = train_Data[ : , : -<span class="hljs-number">1</span> ] <span class="hljs-comment"># 前8 列为输入特征</span><br>Y = train_Data[ : , -<span class="hljs-number">1</span> ].reshape((-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)) <span class="hljs-comment"># 后1 列为输出特征</span><br><span class="hljs-comment"># 此处的.reshape((-1,1))将一阶张量升级为二阶张量</span><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>    Pred = model(X) <span class="hljs-comment"># 一次前向传播（批量）</span><br>    loss = loss_fn(Pred, Y) <span class="hljs-comment"># 计算损失函数</span><br>    losses.append(loss.item()) <span class="hljs-comment"># 记录损失函数的变化</span><br>    optimizer.zero_grad() <span class="hljs-comment"># 清理上一轮滞留的梯度</span><br>    loss.backward() <span class="hljs-comment"># 一次反向传播</span><br>    optimizer.step() <span class="hljs-comment"># 优化内部参数</span><br>Fig = plt.figure()<br>plt.plot(<span class="hljs-built_in">range</span>(epochs), losses)<br>plt.ylabel(<span class="hljs-string">&#x27;loss&#x27;</span>)<br>plt.xlabel(<span class="hljs-string">&#x27;epoch&#x27;</span>)<br>plt.show()<br><br><span class="hljs-comment"># 测试网络</span><br><span class="hljs-comment"># 给测试集划分输入与输出</span><br>X = test_Data[ : , : -<span class="hljs-number">1</span> ] <span class="hljs-comment"># 前8 列为输入特征</span><br>Y = test_Data[ : , -<span class="hljs-number">1</span> ].reshape((-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)) <span class="hljs-comment"># 后1 列为输出特征</span><br><span class="hljs-keyword">with</span> torch.no_grad(): <span class="hljs-comment"># 该局部关闭梯度计算功能</span><br>    Pred = model(X) <span class="hljs-comment"># 一次前向传播（批量）</span><br>    Pred[Pred&gt;=<span class="hljs-number">0.5</span>] = <span class="hljs-number">1</span><br>    Pred[Pred&lt;<span class="hljs-number">0.5</span>] = <span class="hljs-number">0</span><br>    correct = torch.<span class="hljs-built_in">sum</span>( (Pred == Y).<span class="hljs-built_in">all</span>(<span class="hljs-number">1</span>) ) <span class="hljs-comment"># 预测正确的样本</span><br>    total = Y.size(<span class="hljs-number">0</span>) <span class="hljs-comment"># 全部的样本数量</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;测试集精准度: <span class="hljs-subst">&#123;<span class="hljs-number">100</span>*correct/total&#125;</span> %&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="小批量梯度下降">5、小批量梯度下降</h1><p>在使用小批量梯度下降时，必须使用 3 个 PyTorch内置的实用工具（utils）：</p><ul><li>DataSet 用于封装数据集；</li><li>DataLoader 用于加载数据不同的批次；</li><li>random_split 用于划分训练集与测试集</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> random_split<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br>%matplotlib inline<br><br><span class="hljs-comment"># 展示高清图</span><br><span class="hljs-keyword">from</span> matplotlib_inline <span class="hljs-keyword">import</span> backend_inline<br>backend_inline.set_matplotlib_formats(<span class="hljs-string">&#x27;svg&#x27;</span>)<br><br><span class="hljs-comment"># 制作数据集</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyData</span>(<span class="hljs-title class_ inherited__">Dataset</span>): <span class="hljs-comment"># 继承Dataset 类</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, filepath</span>):<br>        df = pd.read_csv(filepath, index_col=<span class="hljs-number">0</span>) <span class="hljs-comment"># 导入数据</span><br>        arr = df.values <span class="hljs-comment"># 对象退化为数组</span><br>        arr = arr.astype(np.float32) <span class="hljs-comment"># 转为float32 类型数组</span><br>        ts = torch.tensor(arr) <span class="hljs-comment"># 数组转为张量</span><br>        ts = ts.to(<span class="hljs-string">&#x27;cuda&#x27;</span>) <span class="hljs-comment"># 把训练集搬到cuda 上</span><br>        self.X = ts[ : , : -<span class="hljs-number">1</span> ] <span class="hljs-comment"># 前8 列为输入特征</span><br>        self.Y = ts[ : , -<span class="hljs-number">1</span> ].reshape((-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)) <span class="hljs-comment"># 后1 列为输出特征</span><br>        self.<span class="hljs-built_in">len</span> = ts.shape[<span class="hljs-number">0</span>] <span class="hljs-comment"># 样本的总数</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, index</span>):<br>        <span class="hljs-keyword">return</span> self.X[index], self.Y[index]<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.<span class="hljs-built_in">len</span><br><br><span class="hljs-comment"># 划分训练集与测试集</span><br>Data = MyData(<span class="hljs-string">&#x27;Data.csv&#x27;</span>)<br>train_size = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(Data) * <span class="hljs-number">0.7</span>) <span class="hljs-comment"># 训练集的样本数量</span><br>test_size = <span class="hljs-built_in">len</span>(Data) - train_size <span class="hljs-comment"># 测试集的样本数量</span><br>train_Data, test_Data = random_split(Data, [train_size, test_size])<br><br><span class="hljs-comment"># 批次加载器</span><br>train_loader = DataLoader(dataset=train_Data, shuffle=<span class="hljs-literal">True</span>, batch_size=<span class="hljs-number">128</span>) <span class="hljs-comment"># shuffle洗牌</span><br>test_loader = DataLoader(dataset=test_Data, shuffle=<span class="hljs-literal">False</span>, batch_size=<span class="hljs-number">64</span>) <span class="hljs-comment"># 测试集就不需要洗牌了</span><br><br><span class="hljs-comment"># 搭建神经网络</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DNN</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27; 搭建神经网络各层 &#x27;&#x27;&#x27;</span><br>        <span class="hljs-built_in">super</span>(DNN,self).__init__()<br>        self.net = nn.Sequential( <span class="hljs-comment"># 按顺序搭建各层</span><br>        nn.Linear(<span class="hljs-number">8</span>, <span class="hljs-number">32</span>), nn.Sigmoid(), <span class="hljs-comment"># 第1 层：全连接层</span><br>        nn.Linear(<span class="hljs-number">32</span>, <span class="hljs-number">8</span>), nn.Sigmoid(), <span class="hljs-comment"># 第2 层：全连接层</span><br>        nn.Linear(<span class="hljs-number">8</span>, <span class="hljs-number">4</span>), nn.Sigmoid(), <span class="hljs-comment"># 第3 层：全连接层</span><br>        nn.Linear(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>), nn.Sigmoid() <span class="hljs-comment"># 第4 层：全连接层</span><br>        )<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27; 前向传播 &#x27;&#x27;&#x27;</span><br>        y = self.net(x) <span class="hljs-comment"># x 即输入数据</span><br>        <span class="hljs-keyword">return</span> y <span class="hljs-comment"># y 即输出数据</span><br><br>model = DNN().to(<span class="hljs-string">&#x27;cuda:0&#x27;</span>) <span class="hljs-comment"># 创建子类的实例，并搬到GPU 上</span><br>model <span class="hljs-comment"># 查看该实例的各层</span><br><br><span class="hljs-comment"># 优化算法的选择</span><br>learning_rate = <span class="hljs-number">0.005</span> <span class="hljs-comment"># 设置学习率</span><br>optimizer = torch.optim.Adam(model.parameters(), lr=learning_rate)<br><br><span class="hljs-comment"># 训练网络</span><br>epochs = <span class="hljs-number">500</span><br>losses = [] <span class="hljs-comment"># 记录损失函数变化的列表</span><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>    <span class="hljs-keyword">for</span> (x, y) <span class="hljs-keyword">in</span> train_loader: <span class="hljs-comment"># 获取小批次的x 与y</span><br>        Pred = model(x) <span class="hljs-comment"># 一次前向传播（小批量）</span><br>        loss = loss_fn(Pred, y) <span class="hljs-comment"># 计算损失函数</span><br>        losses.append(loss.item()) <span class="hljs-comment"># 记录损失函数的变化</span><br>        optimizer.zero_grad() <span class="hljs-comment"># 清理上一轮滞留的梯度</span><br>        loss.backward() <span class="hljs-comment"># 一次反向传播</span><br>        optimizer.step() <span class="hljs-comment"># 优化内部参数</span><br>Fig = plt.figure()<br>plt.plot(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(losses)), losses)<br>plt.show()<br><br><span class="hljs-comment"># 测试网络</span><br>correct = <span class="hljs-number">0</span><br>total = <span class="hljs-number">0</span><br><span class="hljs-keyword">with</span> torch.no_grad(): <span class="hljs-comment"># 该局部关闭梯度计算功能</span><br>    <span class="hljs-keyword">for</span> (x, y) <span class="hljs-keyword">in</span> test_loader: <span class="hljs-comment"># 获取小批次的x 与y</span><br>        Pred = model(x) <span class="hljs-comment"># 一次前向传播（小批量）</span><br>        Pred[Pred&gt;=<span class="hljs-number">0.5</span>] = <span class="hljs-number">1</span><br>        Pred[Pred&lt;<span class="hljs-number">0.5</span>] = <span class="hljs-number">0</span><br>        correct += torch.<span class="hljs-built_in">sum</span>( (Pred == y).<span class="hljs-built_in">all</span>(<span class="hljs-number">1</span>) )<br>        total += y.size(<span class="hljs-number">0</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;测试集精准度: <span class="hljs-subst">&#123;<span class="hljs-number">100</span>*correct/total&#125;</span> %&#x27;</span>)<br></code></pre></td></tr></table></figure><p>小批量时针对局部进行向前向后，所以出来的损失函数不是梯度下降的。</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406302207424.png" /></p><h1 id="手写数字识别">6、手写数字识别</h1><p>手写数字识别数据集（MNIST）是机器学习领域的标准数据集</p><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406302208601.png" /></p><ul><li>输入：一副图像</li><li>输出：一个与图像中对应的数字（0 至 9之间的一个整数，不是独热编码）</li></ul><blockquote><p>我们不用手动将输出转换为独热编码，PyTorch会在整个过程中自动将数据集的输出转换为独热编码.只有在最后测试网络时，我们对比测试集的预测输出与真实输出时，才需要注意一下。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader<br><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> transforms <span class="hljs-comment"># 需要使用pip install安装一下</span><br><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> datasets<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br>%matplotlib inline<br></code></pre></td></tr></table></figure><p>下载时需要开启全局代理</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 制作数据集</span><br><span class="hljs-comment"># 数据集转换参数</span><br>transform = transforms.Compose([<br>    transforms.ToTensor(),<br>    transforms.Normalize(<span class="hljs-number">0.1307</span>, <span class="hljs-number">0.3081</span>)<br>])<br><br><span class="hljs-comment"># 下载训练集与测试集</span><br>train_Data = datasets.MNIST(<br>    root = <span class="hljs-string">&#x27;F:\Jupyter\pytorch\dataset\mnist&#x27;</span>, <span class="hljs-comment"># 下载路径</span><br>    train = <span class="hljs-literal">True</span>, <span class="hljs-comment"># 是train 集</span><br>    download = <span class="hljs-literal">True</span>, <span class="hljs-comment"># 如果该路径没有该数据集，就下载</span><br>    transform = transform <span class="hljs-comment"># 数据集转换参数</span><br>)<br><br>test_Data = datasets.MNIST(<br>    root = <span class="hljs-string">&#x27;F:\Jupyter\pytorch\dataset\mnist&#x27;</span>, <span class="hljs-comment"># 下载路径</span><br>    train = <span class="hljs-literal">False</span>, <span class="hljs-comment"># 是test 集</span><br>    download = <span class="hljs-literal">True</span>, <span class="hljs-comment"># 如果该路径没有该数据集，就下载</span><br>    transform = transform <span class="hljs-comment"># 数据集转换参数</span><br>)<br><br><span class="hljs-comment"># 批次加载器</span><br>train_loader = DataLoader(train_Data, shuffle=<span class="hljs-literal">True</span>, batch_size=<span class="hljs-number">64</span>)<br>test_loader = DataLoader(test_Data, shuffle=<span class="hljs-literal">False</span>, batch_size=<span class="hljs-number">64</span>)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">每个样本的输入都是形状为2828的二维数组，那么对于 DNN 来说，输入层的神经元节点就要有28x28 = 784个；输出层使用独热编码，需要 10 个节点。</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DNN</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27; 搭建神经网络各层 &#x27;&#x27;&#x27;</span><br>        <span class="hljs-built_in">super</span>(DNN,self).__init__()<br>        self.net = nn.Sequential( <span class="hljs-comment"># 按顺序搭建各层</span><br>        nn.Flatten(), <span class="hljs-comment"># 把图像铺平成一维</span><br>        nn.Linear(<span class="hljs-number">784</span>, <span class="hljs-number">512</span>), nn.ReLU(), <span class="hljs-comment"># 第1 层：全连接层</span><br>        nn.Linear(<span class="hljs-number">512</span>, <span class="hljs-number">256</span>), nn.ReLU(), <span class="hljs-comment"># 第2 层：全连接层</span><br>        nn.Linear(<span class="hljs-number">256</span>, <span class="hljs-number">128</span>), nn.ReLU(), <span class="hljs-comment"># 第3 层：全连接层</span><br>        nn.Linear(<span class="hljs-number">128</span>, <span class="hljs-number">64</span>), nn.ReLU(), <span class="hljs-comment"># 第4 层：全连接层</span><br>        nn.Linear(<span class="hljs-number">64</span>, <span class="hljs-number">10</span>) <span class="hljs-comment"># 第5 层：全连接层</span><br>    )<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27; 前向传播 &#x27;&#x27;&#x27;</span><br>        y = self.net(x) <span class="hljs-comment"># x 即输入数据</span><br>        <span class="hljs-keyword">return</span> y <span class="hljs-comment"># y 即输出数据</span><br><br>model = DNN().to(<span class="hljs-string">&#x27;cuda:0&#x27;</span>) <span class="hljs-comment"># 创建子类的实例，并搬到GPU 上</span><br>model <span class="hljs-comment"># 查看该实例的各层</span><br><br><span class="hljs-comment"># 损失函数的选择</span><br>loss_fn = nn.CrossEntropyLoss() <span class="hljs-comment"># 自带softmax 激活函数</span><br><br><span class="hljs-comment"># 优化算法的选择</span><br>learning_rate = <span class="hljs-number">0.01</span> <span class="hljs-comment"># 设置学习率</span><br>optimizer = torch.optim.SGD(<br>    model.parameters(),<br>    lr = learning_rate,<br>    momentum = <span class="hljs-number">0.5</span><br>)<br><br><span class="hljs-comment"># 训练网络</span><br>epochs = <span class="hljs-number">5</span><br>losses = [] <span class="hljs-comment"># 记录损失函数变化的列表</span><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>    <span class="hljs-keyword">for</span> (x, y) <span class="hljs-keyword">in</span> train_loader: <span class="hljs-comment"># 获取小批次的x 与y</span><br>        x, y = x.to(<span class="hljs-string">&#x27;cuda:0&#x27;</span>), y.to(<span class="hljs-string">&#x27;cuda:0&#x27;</span>)<br>        Pred = model(x) <span class="hljs-comment"># 一次前向传播（小批量）</span><br>        loss = loss_fn(Pred, y) <span class="hljs-comment"># 计算损失函数</span><br>        losses.append(loss.item()) <span class="hljs-comment"># 记录损失函数的变化</span><br>        optimizer.zero_grad() <span class="hljs-comment"># 清理上一轮滞留的梯度</span><br>        loss.backward() <span class="hljs-comment"># 一次反向传播</span><br>        optimizer.step() <span class="hljs-comment"># 优化内部参数</span><br>Fig = plt.figure()<br>plt.plot(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(losses)), losses)<br>plt.show()<br><br><span class="hljs-comment"># 测试网络</span><br>correct = <span class="hljs-number">0</span><br>total = <span class="hljs-number">0</span><br><span class="hljs-keyword">with</span> torch.no_grad(): <span class="hljs-comment"># 该局部关闭梯度计算功能</span><br>    <span class="hljs-keyword">for</span> (x, y) <span class="hljs-keyword">in</span> test_loader: <span class="hljs-comment"># 获取小批次的x 与y</span><br>        x, y = x.to(<span class="hljs-string">&#x27;cuda:0&#x27;</span>), y.to(<span class="hljs-string">&#x27;cuda:0&#x27;</span>)<br>        Pred = model(x) <span class="hljs-comment"># 一次前向传播（小批量）</span><br>        _, predicted = torch.<span class="hljs-built_in">max</span>(Pred.data, dim=<span class="hljs-number">1</span>)<br>        correct += torch.<span class="hljs-built_in">sum</span>( (predicted == y) )<br>        total += y.size(<span class="hljs-number">0</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;测试集精准度: <span class="hljs-subst">&#123;<span class="hljs-number">100</span>*correct/total&#125;</span> %&#x27;</span>)<br></code></pre></td></tr></table></figure><p><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202406302232034.png" /></p><p>测试集精准度: 97.06999969482422 %</p>]]></content>
    
    
    <summary type="html">基于pytorch的深度学习笔记，包括环境配置、DNN的实现原理以及批量梯度下降案例、小批量梯度下降案例和手写数字识别案例</summary>
    
    
    
    <category term="编程" scheme="http://example.com/categories/%E7%BC%96%E7%A8%8B/"/>
    
    <category term="大模型" scheme="http://example.com/categories/%E7%BC%96%E7%A8%8B/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"/>
    
    
    <category term="编程" scheme="http://example.com/tags/%E7%BC%96%E7%A8%8B/"/>
    
    <category term="学习笔记" scheme="http://example.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="python" scheme="http://example.com/tags/python/"/>
    
    <category term="深度学习" scheme="http://example.com/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="pytorch" scheme="http://example.com/tags/pytorch/"/>
    
  </entry>
  
  <entry>
    <title>Nest学习笔记</title>
    <link href="http://example.com/2024/06/29/024%20Nest%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://example.com/2024/06/29/024%20Nest%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2024-06-29T12:40:00.000Z</published>
    <updated>2025-02-08T06:47:20.942Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一起步">一、起步</h1><h2 id="项目创建">1.1 项目创建</h2><p>安装脚手架</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ npm i -g @nestjs/cli<br></code></pre></td></tr></table></figure><p>创建新项目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ nest new project-name<br></code></pre></td></tr></table></figure><h2 id="项目文件">1.2 项目文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">src<br> ├── app.controller.spec.ts<br> ├── app.controller.ts<br> ├── app.module.ts<br> ├── app.service.ts<br> └── main.ts<br></code></pre></td></tr></table></figure><p>含义</p><table><thead><tr><th>文件名</th><th>含义</th></tr></thead><tbody><tr><td>app.controller.ts</td><td>带有单个路由的基本控制器示例。</td></tr><tr><td>app.controller.spec.ts</td><td>对于基本控制器的单元测试样例</td></tr><tr><td>app.module.ts</td><td>应用程序的根模块。</td></tr><tr><td>app.service.ts</td><td>带有单个方法的基本服务</td></tr><tr><td>main.ts</td><td>应用程序入口文件。它使用 <code>NestFactory</code> 用来创建 Nest应用实例。</td></tr></tbody></table><h2 id="启动项目">1.3 启动项目</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> demo1<br>yarn run start<br></code></pre></td></tr></table></figure><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113144220518.png"alt="image-20230113144220518" /><figcaption aria-hidden="true">image-20230113144220518</figcaption></figure><p>热启动项目（实时更新）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yarn start:dev<br></code></pre></td></tr></table></figure><h2 id="主文件">1.4 主文件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// main.ts</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NestFactory</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/core&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AppModule</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./app.module&quot;</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">AppModule</span>);<br>  <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);<br>&#125;<br><span class="hljs-title function_">bootstrap</span>();<br></code></pre></td></tr></table></figure><p>要创建一个 Nest 应用实例，我们使用了 <code>NestFactory</code>核心类。<code>NestFactory</code>暴露了一些静态方法用于创建应用实例。</p><p><code>create()</code> 方法返回一个实现 <code>INestApplication</code>接口的对象。该对象提供了一组可用的方法，我们会在后面的章节中对这些方法进行详细描述。在上面的 <code>main.ts</code> 示例中，我们只是启动 HTTP服务，让应用程序等待 HTTP 请求。</p><h2 id="创建-moudle">1.5 创建 Moudle</h2><h3 id="手动创建">1.5.1 手动创建</h3><p>src/auth/auth.moudle.ts</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Module</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><br><span class="hljs-meta">@Module</span>(&#123;&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthModule</span> &#123;&#125;<br></code></pre></td></tr></table></figure><p>导入到 app 中</p><p>src/app.module.ts</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Module</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AuthModule</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./auth/auth.module&quot;</span>;<br><br><span class="hljs-meta">@Module</span>(&#123;<br>  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">AuthModule</span>],<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> &#123;&#125;<br></code></pre></td></tr></table></figure><h3 id="命令行创建">1.5.2 命令行创建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs base">nest g module user<br></code></pre></td></tr></table></figure><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113165522565.png"alt="image-20230113165522565" /><figcaption aria-hidden="true">image-20230113165522565</figcaption></figure><h2 id="创建完整模块">1.6 创建完整模块</h2><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113170716951.png"alt="image-20230113170716951" /><figcaption aria-hidden="true">image-20230113170716951</figcaption></figure><p>controller 关注于请求的逻辑</p><p>service 关注具体实现</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// src/auth/auth.module.ts</span><br><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Module</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AuthContriller</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./auth.controller&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AuthService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./auth.service&quot;</span>;<br><br><span class="hljs-meta">@Module</span>(&#123;<br>  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">AuthContriller</span>],<br>  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AuthService</span>],<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthModule</span> &#123;&#125;<br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// src/auth/auth.controller.ts</span><br><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Post</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AuthService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./auth.service&quot;</span>;<br><br><span class="hljs-meta">@Controller</span>(<span class="hljs-string">&quot;auth&quot;</span>)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthContriller</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> authService: AuthService</span>) &#123;&#125;<br><br>  <span class="hljs-comment">// Post auth/signup</span><br>  <span class="hljs-meta">@Post</span>(<span class="hljs-string">&quot;signup&quot;</span>)<br>  <span class="hljs-title function_">signup</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">authService</span>.<span class="hljs-title function_">signup</span>();<br>  &#125;<br><br>  <span class="hljs-comment">// Post auth/signin</span><br>  <span class="hljs-meta">@Post</span>(<span class="hljs-string">&quot;signin&quot;</span>)<br>  <span class="hljs-title function_">signin</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">authService</span>.<span class="hljs-title function_">signin</span>();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// src/auth/auth.service.ts</span><br><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Injectable</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><br><span class="hljs-meta">@Injectable</span>()<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthService</span> &#123;<br>  <span class="hljs-title function_">signup</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;This is a signup page!&quot;</span> &#125;;<br>  &#125;<br><br>  <span class="hljs-title function_">signin</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;This is a signin page!&quot;</span> &#125;;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="二基本概念">二、基本概念</h1><h2 id="控制器">2.1 控制器</h2><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113144733598.png"alt="image-20230113144733598" /><figcaption aria-hidden="true">image-20230113144733598</figcaption></figure><p>目的：接受应用的特定请求；</p><p>控制器与路由：通常一个控制器含多个请求，不同的路由执行不同的操纵；</p><p>创建控制器：使用类和<code>装饰器</code>；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ nest g controller cats<br></code></pre></td></tr></table></figure><h3 id="路由">2.1.1 路由</h3><p>在下面的例子中，我们使用 <code>@Controller()</code>装饰器定义一个基本的控制器。</p><p>可选 路由路径前缀设置为 <code>custom</code>。在<code>@Controller()</code>装饰器中使用路径前缀可以使我们轻松地对一组相关的路由进行分组，并最大程度地减少重复代码。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// app.controller.ts</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Get</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AppService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./app.service&quot;</span>;<br><br><span class="hljs-meta">@Controller</span>(<span class="hljs-string">&quot;/custom&quot;</span>)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppController</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> appService: AppService</span>) &#123;&#125;<br><br>  <span class="hljs-meta">@Get</span>(<span class="hljs-string">&quot;/eye&quot;</span>)<br>  <span class="hljs-title function_">getEye</span>(): <span class="hljs-built_in">string</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;我是眼睛&quot;</span>;<br>  &#125;<br><br>  <span class="hljs-meta">@Get</span>(<span class="hljs-string">&quot;/mouse&quot;</span>)<br>  <span class="hljs-title function_">getMouse</span>(): <span class="hljs-built_in">string</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;我是嘴巴&quot;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>请求</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113145438467.png"alt="image-20230113145438467" /><figcaption aria-hidden="true">image-20230113145438467</figcaption></figure><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113145600949.png"alt="image-20230113145600949" /><figcaption aria-hidden="true">image-20230113145600949</figcaption></figure><blockquote><p>这里案例来说应该返回状态码加数据，而网页中直接显示了数据，原因是 nest有两种操作响应。</p><p>标准：使用这个内置方法，当请求处理程序返回一个<code>JavaScript</code> 对象或数组时，它将自动序列化为<code>JSON</code>。但是，当它返回一个 <code>JavaScript</code>基本类型（例如<code>string、number、boolean</code>）时， Nest将只发送值，而不尝试序列化它。这使响应处理变得简单：只需要返回值，其余的由Nest 负责。</p><p>类库特有：我们可以在函数签名处通过 <code>@Res()</code>注入类库特定的响应对象（例如，<code>Express</code>）。使用此方法，你就能使用由该响应对象暴露的原生响应处理函数。例如，使用<code>Express</code>，您可以使用<code>response.status(200).send()</code> 构建响应</p></blockquote><p>类库特有</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Get</span>(<span class="hljs-string">&#x27;head&#x27;</span>)<br><span class="hljs-title function_">getHead</span>(<span class="hljs-params"><span class="hljs-meta">@Res</span>() res</span>) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">OK</span>).<span class="hljs-title function_">send</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>而且，在上面的示例中，你失去与依赖于 Nest 标准响应处理的 Nest功能（例如，拦截器（Interceptors） 和<code>@HttpCode()</code>/<code>@Header()</code>装饰器）的兼容性。要解决此问题，可以将 <code>passthrough</code>选项设置为 <code>true</code>，如下所示：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Get</span>(<span class="hljs-string">&#x27;head&#x27;</span>)<br><span class="hljs-title function_">getHead</span>(<span class="hljs-params"><span class="hljs-meta">@Res</span>(&#123;passthrough:<span class="hljs-literal">true</span>&#125;) res</span>) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">OK</span>)<br>    <span class="hljs-keyword">return</span> []<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="request">2.1.2 <ahref="https://docs.nestjs.cn/9/controllers?id=request">Request</a></h3><p>访问请求细节。</p><p>需要引入<code>Req</code>和<code>import &#123;Request&#125; from 'express';</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Get</span>, <span class="hljs-title class_">Req</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AppService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./app.service&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Request</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;express&quot;</span>;<br><br><span class="hljs-meta">@Controller</span>(<span class="hljs-string">&quot;/custom&quot;</span>)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppController</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> appService: AppService</span>) &#123;&#125;<br><br>  <span class="hljs-meta">@Get</span>(<span class="hljs-string">&quot;/eye&quot;</span>)<br>  <span class="hljs-title function_">getEye</span>(<span class="hljs-meta">@Req</span>() <span class="hljs-attr">request</span>: <span class="hljs-title class_">Request</span>): <span class="hljs-built_in">string</span> &#123;<br>    <span class="hljs-comment">// 这里的Request表示类型</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(request);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;我是眼睛&quot;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p><code>Request</code> 对象代表 <code>HTTP</code>请求，并具有查询字符串，请求参数参数，HTTP 标头（HTTP header） 和正文（HTTP body）的属性（在<ahref="https://expressjs.com/en/api.html#req">这里</a>阅读更多）。在多数情况下，不必手动获取它们。我们可以使用专用的装饰器，比如开箱即用的 <code>@Body()</code> 或<code>@Query()</code> 。 下面是 Nest提供的装饰器及其代表的底层平台特定对象的对照列表。</p></blockquote><p>多个装饰器</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Get</span>(<span class="hljs-string">&#x27;/eye&#x27;</span>)<br><span class="hljs-title function_">getEye</span>(<span class="hljs-meta">@Req</span>() <span class="hljs-attr">request</span>:<span class="hljs-title class_">Request</span>,<span class="hljs-meta">@Ip</span>() ip,<span class="hljs-meta">@HostParam</span>() host): <span class="hljs-built_in">string</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(request.<span class="hljs-property">ip</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ip);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(host);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;我是眼睛&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="post">2.1.3 Post</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Post</span>(<span class="hljs-string">&#x27;/foot&#x27;</span>)<br><span class="hljs-title function_">getFoot</span>():<span class="hljs-built_in">string</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;我是脚&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113153133595.png"alt="image-20230113153133595" /><figcaption aria-hidden="true">image-20230113153133595</figcaption></figure><blockquote><p>Nest 为所有标准的 HTTP方法提供了相应的装饰器：<code>@Put()</code>、<code>@Delete()</code>、<code>@Patch()</code>、<code>@Options()</code>、以及<code>@Head()</code>。此外，<code>@All()</code>则用于定义一个用于处理所有 HTTP 请求方法的处理程序。</p></blockquote><h3 id="路由通配符">2.1.4 路由通配符</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Get</span>(<span class="hljs-string">&#x27;hand*s&#x27;</span>)<br><span class="hljs-title function_">getHead</span>():<span class="hljs-built_in">string</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;我是手&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113154504739.png"alt="image-20230113154504739" /><figcaption aria-hidden="true">image-20230113154504739</figcaption></figure><blockquote><p>路由路径 <code>'ab*cd'</code> 将匹配 <code>abcd</code>、<code>ab_cd</code> 、<code>abecd</code> 等。字符 <code>?</code>、<code>+</code> 、 <code>*</code> 以及 <code>()</code>是它们的正则表达式对应项的子集。连字符（<code>-</code>）和点（<code>.</code>）按字符串路径逐字解析。</p></blockquote><h3 id="状态码">2.1.5 状态码</h3><p>状态码默认是 200（post 为201），可通过<code>@HttpCode()</code>更改状态码</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Post</span>(<span class="hljs-string">&#x27;foot&#x27;</span>)<br><span class="hljs-meta">@HttpCode</span>(<span class="hljs-number">204</span>)<br><span class="hljs-title function_">getFoot</span>():<span class="hljs-built_in">string</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;我是脚&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="headers">2.1.6 <ahref="https://docs.nestjs.cn/9/controllers?id=headers">Headers</a></h3><p>指定自定义响应头，可以使用 <code>@header()</code>装饰器或类库特有的响应对象</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Post</span>()<br><span class="hljs-meta">@Header</span>(<span class="hljs-string">&#x27;Cache-Control&#x27;</span>, <span class="hljs-string">&#x27;none&#x27;</span>)<br><span class="hljs-title function_">create</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;This action adds a new cat&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="重定向">2.1.7 重定向</h3><p>要将响应重定向到特定的 <code>URL</code>，可以使用<code>@Redirect()</code> 装饰器或特定于库的响应对象</p><p><code>@Redirect()</code>装饰器有两个可选参数，<code>url</code>和<code>statusCode</code>。 如果省略，则 <code>statusCode</code> 默认为<code>302</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Get</span>()<br><span class="hljs-meta">@Redirect</span>(<span class="hljs-string">&#x27;https://nestjs.com&#x27;</span>, <span class="hljs-number">301</span>)<br></code></pre></td></tr></table></figure><h3 id="路由参数">2.1.8 路由参数</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Get</span>(<span class="hljs-string">&#x27;mouse/:id&#x27;</span>)<br><span class="hljs-title function_">getMouseId</span>(<span class="hljs-meta">@Param</span>() params): <span class="hljs-built_in">string</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`我是嘴巴<span class="hljs-subst">$&#123;params.id&#125;</span>`</span><br>&#125;<br></code></pre></td></tr></table></figure><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113155638965.png"alt="image-20230113155638965" /><figcaption aria-hidden="true">image-20230113155638965</figcaption></figure><p>或者写成</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Get</span>(<span class="hljs-string">&#x27;mouse/:id&#x27;</span>)<br><span class="hljs-title function_">getMouseId</span>(<span class="hljs-meta">@Param</span>(<span class="hljs-string">&#x27;id&#x27;</span>) id): <span class="hljs-built_in">string</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`我是嘴巴<span class="hljs-subst">$&#123;id&#125;</span>`</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="子域路由">2.1.9 <ahref="https://docs.nestjs.cn/9/controllers?id=子域路由">子域路由</a></h3><p><code>@Controller</code> 装饰器可以接受一个 <code>host</code>选项，以要求传入请求的 <code>HTTP</code> 主机匹配某个特定值</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Controller</span>(&#123; <span class="hljs-attr">host</span>: <span class="hljs-string">&quot;admin.example.com&quot;</span> &#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminController</span> &#123;<br>  <span class="hljs-meta">@Get</span>()<br>  <span class="hljs-title function_">index</span>(): <span class="hljs-built_in">string</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Admin page&quot;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="异步性">2.1.10 异步性</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/* cats.controller.ts */</span><br><br><span class="hljs-meta">@Get</span>()<br><span class="hljs-keyword">async</span> <span class="hljs-title function_">findAll</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>[]&gt; &#123;<br>  <span class="hljs-keyword">return</span> [];<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="请求负载">2.1.11 请求负载</h3><p>首先（如果您使用 TypeScript），我们需要确定<code>DTO</code>（数据传输对象）模式。<code>DTO</code>是一个对象，它定义了如何通过网络发送数据。我们可以通过使用<strong>TypeScript</strong> 接口（Interface）或简单的类（Class）来定义DTO 模式。有趣的是，我们在这里推荐使用<strong>类</strong>。</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113193701850.png"alt="image-20230113193701850" /><figcaption aria-hidden="true">image-20230113193701850</figcaption></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/*</span><br><span class="hljs-comment">  create-auto.dto.ts</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateAuthDto</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/* auto.controller.ts */</span><br><br><span class="hljs-meta">@Get</span>(<span class="hljs-string">&#x27;getUser/:id&#x27;</span>)<br><span class="hljs-title function_">getUser</span>(<span class="hljs-params"></span><br><span class="hljs-params">    <span class="hljs-meta">@Body</span>() body:CreateAuthDto,</span><br><span class="hljs-params">    <span class="hljs-meta">@Param</span>() params:&#123;id:<span class="hljs-built_in">number</span>&#125;</span><br><span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">authService</span>.<span class="hljs-title function_">getUser</span>(body,params);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/* auto.service.ts */</span><br><br><span class="hljs-title function_">getUser</span>(<span class="hljs-params"></span><br><span class="hljs-params">    body:CreateAuthDto,</span><br><span class="hljs-params">    params:&#123;id:<span class="hljs-built_in">number</span>&#125;</span><br><span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-attr">msg</span>:body,params&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="六管道">六、管道</h1><h2 id="应用场景">6.1 应用场景</h2><p>管道有两个典型的应用场景:</p><ul><li><strong>转换</strong>：管道将输入数据转换为所需的数据输出(例如，将字符串转换为整数)</li><li><strong>验证</strong>：对输入数据进行验证，如果验证成功继续传递;验证失败则抛出异常</li></ul><h2 id="内置管道">6.2 内置管道</h2><p><code>Nest</code> 自带九个开箱即用的管道，即</p><ul><li><code>ValidationPipe</code></li><li><code>ParseIntPipe</code></li><li><code>ParseFloatPipe</code></li><li><code>ParseBoolPipe</code></li><li><code>ParseArrayPipe</code></li><li><code>ParseUUIDPipe</code></li><li><code>ParseEnumPipe</code></li><li><code>DefaultValuePipe</code></li><li><code>ParseFilePipe</code></li></ul><p>他们从 <code>@nestjs/common</code> 包中导出。</p><h2 id="绑定管道">6.3 绑定管道</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/* auth.controller.ts */</span><br><br><span class="hljs-meta">@Get</span>(<span class="hljs-string">&#x27;searchUser/:useId&#x27;</span>)<br><span class="hljs-title function_">searchUser</span>(<span class="hljs-params"><span class="hljs-meta">@Param</span>(<span class="hljs-string">&#x27;useId&#x27;</span>,ParseIntPipe) id:<span class="hljs-built_in">number</span></span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">authService</span>.<span class="hljs-title function_">searchUser</span>(id);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/* auth.service.ts */</span><br><br><span class="hljs-title function_">searchUser</span>(<span class="hljs-params">id:<span class="hljs-built_in">number</span></span>)&#123;<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-attr">msg</span>:id&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>这里绑定的管道是一个类而不是一个实例对象，如果要改变内置管道的行为，在绑定时通过new 新建一个实例对象并绑定</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Get</span>(<span class="hljs-string">&#x27;searchUser/:useId&#x27;</span>)<br><span class="hljs-title function_">searchUser</span>(<span class="hljs-params"><span class="hljs-meta">@Param</span>(<span class="hljs-string">&#x27;useId&#x27;</span>,<span class="hljs-keyword">new</span> ParseIntPipe(&#123; errorHttpStatusCode: HttpStatus.NOT_ACCEPTABLE &#125;)) id:<span class="hljs-built_in">number</span></span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">authService</span>.<span class="hljs-title function_">searchUser</span>(id);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>且会将 string 转换为 int</p></blockquote><p>成功</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113195136018.png"alt="image-20230113195136018" /><figcaption aria-hidden="true">image-20230113195136018</figcaption></figure><p>失败</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113195219407.png"alt="image-20230113195219407" /><figcaption aria-hidden="true">image-20230113195219407</figcaption></figure><h1 id="七技术">七、技术</h1><h2 id="验证">7.1<ahref="https://docs.nestjs.cn/9/techniques?id=%e9%aa%8c%e8%af%81">验证</a></h2><h3 id="全局使用">7.1.1 全局使用</h3><p>安装依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ npm i --save class-validator class-transformer<br></code></pre></td></tr></table></figure><p>注入全局验证管道</p><p><code>app.useGlobalPipes(new ValidationPipe())</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/* main.ts */</span><br><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ValidationPipe</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NestApplication</span>, <span class="hljs-title class_">NestFactory</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/core&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AppModule</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./app.module&quot;</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">AppModule</span>);<br>  app.<span class="hljs-title function_">useGlobalPipes</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValidationPipe</span>());<br>  <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);<br>&#125;<br><span class="hljs-title function_">bootstrap</span>();<br></code></pre></td></tr></table></figure><p>Dto</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">IsEmail</span>, <span class="hljs-title class_">IsNotEmpty</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;class-validator&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UpdateAuthDto</span> &#123;<br>  <span class="hljs-meta">@IsEmail</span>()<br>  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// email验证</span><br><br>  <span class="hljs-meta">@IsNotEmpty</span>()<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 不为空验证</span><br>&#125;<br></code></pre></td></tr></table></figure><p>使用验证</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/* auth.controller.ts */</span><br><br><span class="hljs-meta">@Get</span>(<span class="hljs-string">&#x27;updateUser&#x27;</span>)<br><span class="hljs-title function_">updateUser</span>(<span class="hljs-params"><span class="hljs-meta">@Body</span>() body:UpdateAuthDto</span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">authService</span>.<span class="hljs-title function_">updateUser</span>(body);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/* auth.service.ts */</span><br><br><span class="hljs-title function_">updateUser</span>(<span class="hljs-params">body:UpdateAuthDto</span>)&#123;<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-attr">msg</span>:body&#125;;<br>&#125;<br></code></pre></td></tr></table></figure><p>失败</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113211331532.png"alt="image-20230113211331532" /><figcaption aria-hidden="true">image-20230113211331532</figcaption></figure><p>成功</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113211258694.png"alt="image-20230113211258694" /><figcaption aria-hidden="true">image-20230113211258694</figcaption></figure><h3 id="剥离属性">7.1.2 剥离属性</h3><blockquote><p>有时我们不处理 token这个字段，而前端在请求时发送了这个字段，这是可以使用剥离属性，将不接受用不到的属性</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript">app.<span class="hljs-title function_">useGlobalPipes</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">ValidationPipe</span>(&#123;<br>    <span class="hljs-attr">whitelist</span>: <span class="hljs-literal">true</span>,<br>  &#125;)<br>);<br></code></pre></td></tr></table></figure><p>使用后</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230113212050272.png"alt="image-20230113212050272" /><figcaption aria-hidden="true">image-20230113212050272</figcaption></figure><h3 id="使用管道转换">7.1.3 使用管道转换</h3><p>如我们在发送 get 请求时，携带 body 中有 age，但是发送到后端 age 变成string，我们需要将 string 变成 int，只需要使用 6.3 即可。</p><h2 id="使用-mongo-数据库">7.2 使用 Mongo 数据库</h2><h3 id="基本步骤">7.2.1 基本步骤</h3><p>安装相关依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yarn add --save @nestjs/mongoose mongoose<br></code></pre></td></tr></table></figure><p>连接数据库</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/* app.module.ts */</span><br><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Module</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">MongooseModule</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/mongoose&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AuthModule</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./auth/auth.module&quot;</span>;<br><br><span class="hljs-meta">@Module</span>(&#123;<br>  <span class="hljs-attr">imports</span>: [<br>    <span class="hljs-title class_">AuthModule</span>,<br>    <span class="hljs-title class_">MongooseModule</span>.<span class="hljs-title function_">forRoot</span>(<span class="hljs-string">&quot;mongodb://127.0.0.1:27017/musicians&quot;</span>),<br>  ],<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> &#123;&#125;<br></code></pre></td></tr></table></figure><blockquote><p>表示连接 musicians 数据库</p></blockquote><p>创建一个模型</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/* src/auth/schema/users.schema.ts */</span><br><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> mongoose <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;mongoose&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Schema</span> = mongoose.<span class="hljs-property">Schema</span>;<br><span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>(&#123;<br>  <span class="hljs-attr">username</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span> &#125;,<br>  <span class="hljs-attr">password</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span> &#125;,<br>  <span class="hljs-attr">mobile</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span> &#125;,<br>  <span class="hljs-attr">email</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span> &#125;,<br>  <span class="hljs-attr">status</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span> &#125;,<br>  <span class="hljs-attr">role_id</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span> &#125;,<br>  <span class="hljs-attr">add_time</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: d.<span class="hljs-title function_">getTime</span>() &#125;,<br>  <span class="hljs-attr">is_supper</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span> &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure><p>引入模型</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Module</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AuthContriller</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./auth.controller&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AuthService</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./auth.service&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">MongooseModule</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/mongoose&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">UserSchema</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./schema/users.schema&quot;</span>;<br><br><span class="hljs-meta">@Module</span>(&#123;<br>  <span class="hljs-attr">imports</span>: [<br>    <span class="hljs-title class_">MongooseModule</span>.<span class="hljs-title function_">forFeature</span>([<br>      &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;User&quot;</span>,<br>        <span class="hljs-attr">schema</span>: <span class="hljs-title class_">UserSchema</span>,<br>        <span class="hljs-attr">collection</span>: <span class="hljs-string">&quot;test&quot;</span>,<br>      &#125;,<br>    ]),<br>  ],<br>  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">AuthContriller</span>],<br>  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AuthService</span>],<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthModule</span> &#123;&#125;<br></code></pre></td></tr></table></figure><p>模型的名称为 User，集合 test</p><p>使用模型</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Injectable</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/common&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">InjectModel</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/mongoose&quot;</span>;<br><br><span class="hljs-meta">@Injectable</span>()<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthService</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-meta">@InjectModel</span>(<span class="hljs-string">&quot;User&quot;</span>) <span class="hljs-keyword">private</span> userModel</span>) &#123;&#125;<br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">signup</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userModel</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">exec</span>();<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">msg</span>: result &#125;;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>依赖注入创建 userModel 属性</p></blockquote><p>创建成功</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230114213520674.png"alt="image-20230114213520674" /><figcaption aria-hidden="true">image-20230114213520674</figcaption></figure><h3 id="crud">7.2.2 CRUD</h3><p>创建用户</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/* auth.controller.ts */</span><br><span class="hljs-meta">@Post</span>(<span class="hljs-string">&#x27;addUser&#x27;</span>)<br><span class="hljs-title function_">addUser</span>(<span class="hljs-params"><span class="hljs-meta">@Body</span>() body:<span class="hljs-built_in">any</span></span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">authService</span>.<span class="hljs-title function_">addUser</span>(body);<br>&#125;<br><br><br><span class="hljs-comment">/* auth.service.ts */</span><br><span class="hljs-keyword">async</span> <span class="hljs-title function_">addUser</span>(<span class="hljs-params">body:<span class="hljs-built_in">any</span></span>)&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userModel</span>.<span class="hljs-title function_">create</span>(body);<br>    <span class="hljs-keyword">return</span> body;<br>&#125;<br></code></pre></td></tr></table></figure><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/image-20230114214717752.png"alt="image-20230114214717752" /><figcaption aria-hidden="true">image-20230114214717752</figcaption></figure><p>查询所有用户</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">findAll</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userModel</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">exec</span>();<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-attr">msg</span>:result&#125;;<br>&#125;<br></code></pre></td></tr></table></figure><p>查找单个用户</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">findOne</span>(<span class="hljs-attr">_id</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span>&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userModel</span>.<span class="hljs-title function_">findById</span>(_id);<br>&#125;<br></code></pre></td></tr></table></figure><p>编辑单个用户</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">editOne</span>(<span class="hljs-attr">_id</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">body</span>: <span class="hljs-title class_">EditUserDTO</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userModel</span>.<span class="hljs-title function_">findByIdAndUpdate</span>(_id, body);<br>&#125;<br></code></pre></td></tr></table></figure><p>删除用户</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">deleteOne</span>(<span class="hljs-attr">_id</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userModel</span>.<span class="hljs-title function_">findByIdAndDelete</span>(_id);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="附件">附件</h1><h2 id="装饰器">装饰器</h2><table><thead><tr><th>装饰器</th><th>含义</th></tr></thead><tbody><tr><td><span class="citation"data-cites="Controller">@Controller</span>()</td><td>定义一个基本控制器</td></tr><tr><td><span class="citation" data-cites="Get">@Get</span>()</td><td>定义一个 get 接口</td></tr><tr><td><span class="citation" data-cites="Post">@Post</span>()</td><td>定义一个 post 接口</td></tr><tr><td><span class="citation" data-cites="Put">@Put</span>()</td><td>定义一个 put 接口</td></tr><tr><td><span class="citation" data-cites="Delete">@Delete</span>()</td><td>定义一个 delete 接口</td></tr><tr><td><span class="citation" data-cites="Patch">@Patch</span>()</td><td>定义一个 patch 接口</td></tr><tr><td><span class="citation" data-cites="Options">@Options</span>()</td><td>定义一个 option 接口</td></tr><tr><td><span class="citation" data-cites="All">@All</span>()</td><td>定义一个处理所有 HTTP 请求的接口</td></tr><tr><td><span class="citation" data-cites="Request">@Request</span>()，<spanclass="citation" data-cites="Req">@Req</span>()</td><td>对应 req，Nest 将请求对象注入处理到</td></tr><tr><td><span class="citation"data-cites="Response">@Response</span>()，<span class="citation"data-cites="Res">@Res</span>()*</td><td>对应 res</td></tr><tr><td><span class="citation" data-cites="Next">@Next</span>()</td><td>对应 next</td></tr><tr><td><span class="citation" data-cites="Session">@Session</span>()</td><td>对应 req.session</td></tr><tr><td><span class="citation" data-cites="Param">@Param</span>(key?:string)</td><td>对应 req.params<code>/</code>req.params[key] get</td></tr><tr><td><span class="citation" data-cites="Body">@Body</span>(key?:string)</td><td>对应 req.body<code>/</code>req.body[key] post</td></tr><tr><td><span class="citation" data-cites="Query">@Query</span>(key?:string)</td><td>对应 req.query<code>/</code>req.query[key]</td></tr><tr><td><span class="citation" data-cites="Headers">@Headers</span>(name?:string)</td><td>对应 req.headers<code>/</code>req.headers[name]</td></tr><tr><td><span class="citation" data-cites="Ip">@Ip</span>()</td><td>对应 req.ip</td></tr><tr><td><span class="citation"data-cites="HostParam">@HostParam</span>()</td><td>对应 req.hosts</td></tr><tr><td><span class="citation" data-cites="HttpCode">@HttpCode</span>()</td><td>更改状态码</td></tr><tr><td><span class="citation" data-cites="Header">@Header</span>()</td><td>更改请求头</td></tr><tr><td><span class="citation" data-cites="Module">@Module</span>()</td><td>定义模块</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">Nest学习笔记，包括基本概念、控制器、管道等</summary>
    
    
    
    <category term="编程" scheme="http://example.com/categories/%E7%BC%96%E7%A8%8B/"/>
    
    <category term="后端" scheme="http://example.com/categories/%E7%BC%96%E7%A8%8B/%E5%90%8E%E7%AB%AF/"/>
    
    <category term="Nest" scheme="http://example.com/categories/%E7%BC%96%E7%A8%8B/%E5%90%8E%E7%AB%AF/Nest/"/>
    
    
    <category term="编程" scheme="http://example.com/tags/%E7%BC%96%E7%A8%8B/"/>
    
    <category term="后端" scheme="http://example.com/tags/%E5%90%8E%E7%AB%AF/"/>
    
    <category term="Nest" scheme="http://example.com/tags/Nest/"/>
    
  </entry>
  
  <entry>
    <title>ICEM常遇问题</title>
    <link href="http://example.com/2024/06/29/025%20ICEM%E5%B8%B8%E9%81%87%E5%88%B0%E9%97%AE%E9%A2%98/"/>
    <id>http://example.com/2024/06/29/025%20ICEM%E5%B8%B8%E9%81%87%E5%88%B0%E9%97%AE%E9%A2%98/</id>
    <published>2024-06-29T12:40:00.000Z</published>
    <updated>2025-02-08T06:47:20.942Z</updated>
    
    <content type="html"><![CDATA[<h2 id="d-网格不闭合">2D 网格不闭合</h2><blockquote><p>Mesh has uncovered edges. ANSYS Fluent needs a complete boundary(lines in 2D) or it will give a variety of errors and not read in themesh! If this was 2D Hexa, perhaps your edges are not associated withperimeter curves</p></blockquote><p>原因是线和线之间可能没有关联</p><figure><imgsrc="https://test-123456-md-images.oss-cn-beijing.aliyuncs.com/img/202302161539612.png"alt="image.png" /><figcaption aria-hidden="true">image.png</figcaption></figure>]]></content>
    
    
    <summary type="html">在使用ICEM划分网格时常遇到的问题</summary>
    
    
    
    <category term="模拟" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="ICEM" scheme="http://example.com/categories/%E6%A8%A1%E6%8B%9F/ICEM/"/>
    
    
    <category term="模拟" scheme="http://example.com/tags/%E6%A8%A1%E6%8B%9F/"/>
    
    <category term="ICEM" scheme="http://example.com/tags/ICEM/"/>
    
  </entry>
  
  <entry>
    <title>Python调用REFPROP</title>
    <link href="http://example.com/2024/06/29/023%20Python%E8%B0%83%E7%94%A8REFPROP/"/>
    <id>http://example.com/2024/06/29/023%20Python%E8%B0%83%E7%94%A8REFPROP/</id>
    <published>2024-06-29T12:30:00.000Z</published>
    <updated>2025-02-08T06:47:20.941Z</updated>
    
    <content type="html"><![CDATA[<h1 id="python-调用-refprop">python 调用 REFPROP</h1><h2 id="安装调试">1、安装调试</h2><ol type="1"><li>安装 refprop10</li><li>安装 python 库<code>pip install ctREFPROP</code></li></ol><p>测试使用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os, numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> ctREFPROP.ctREFPROP <span class="hljs-keyword">import</span> REFPROPFunctionLibrary<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">NBP</span>():<br>    RP = REFPROPFunctionLibrary(os.environ[<span class="hljs-string">&#x27;RPPREFIX&#x27;</span>])<br>    RP.SETPATHdll(os.environ[<span class="hljs-string">&#x27;RPPREFIX&#x27;</span>])<br>    <span class="hljs-built_in">print</span>(RP.RPVersion())<br>    MOLAR_BASE_SI = RP.GETENUMdll(<span class="hljs-number">0</span>,<span class="hljs-string">&quot;MOLAR BASE SI&quot;</span>).iEnum<br><br>    r = RP.REFPROPdll(<span class="hljs-string">&quot;PROPANE&quot;</span>,<span class="hljs-string">&quot;PQ&quot;</span>,<span class="hljs-string">&quot;T&quot;</span>,MOLAR_BASE_SI, <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">101325</span>, <span class="hljs-number">0</span>, [<span class="hljs-number">1.0</span>])<br>    <span class="hljs-built_in">print</span>(r.ierr, r.herr, r.Output[<span class="hljs-number">0</span>])<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># 路径</span><br>    os.environ[<span class="hljs-string">&#x27;RPPREFIX&#x27;</span>] = <span class="hljs-string">r&#x27;D:/REFPROP10&#x27;</span><br><br>    NBP()<br><br>&gt;&gt;<br><span class="hljs-number">10.0</span><br><span class="hljs-number">0</span>  <span class="hljs-number">231.0362479100902</span><br></code></pre></td></tr></table></figure><h2 id="基本语法">2、基本语法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os, numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> ctREFPROP.ctREFPROP <span class="hljs-keyword">import</span> REFPROPFunctionLibrary<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_properties</span>():<br>    <span class="hljs-comment"># 初始化REFPROP</span><br>    RP = REFPROPFunctionLibrary(os.environ[<span class="hljs-string">&#x27;RPPREFIX&#x27;</span>])<br>    RP.SETPATHdll(os.environ[<span class="hljs-string">&#x27;RPPREFIX&#x27;</span>])<br><br>    <span class="hljs-comment"># 将单位设置为国际单位制（摩尔基准）</span><br>    MOLAR_BASE_SI = RP.GETENUMdll(<span class="hljs-number">0</span>, <span class="hljs-string">&quot;MASS BASE SI&quot;</span>).iEnum<br><br>    <span class="hljs-comment"># 指定物质（氢）、计算类型（H为焓值，D为密度，S为熵值）</span><br>    substance = <span class="hljs-string">&quot;HYDROGEN&quot;</span><br><br>    <span class="hljs-comment"># 指定输入条件（温度、压力）</span><br>    temperature = <span class="hljs-number">298.15</span>  <span class="hljs-comment"># 单位：K</span><br>    pressure = <span class="hljs-number">101325</span>  <span class="hljs-comment"># 单位：Pa</span><br><br>    <span class="hljs-comment"># 调用REFPROPdll计算性质</span><br>    H_result = RP.REFPROPdll(substance, <span class="hljs-string">&quot;PT&quot;</span>,<span class="hljs-string">&quot;H&quot;</span>,  MOLAR_BASE_SI, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, pressure, temperature, [<span class="hljs-number">1.0</span>]) <span class="hljs-comment"># J/kg</span><br>    D_result = RP.REFPROPdll(substance, <span class="hljs-string">&quot;PT&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,  MOLAR_BASE_SI, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, pressure, temperature, [<span class="hljs-number">1.0</span>]) <span class="hljs-comment"># kg/m3</span><br>    S_result = RP.REFPROPdll(substance, <span class="hljs-string">&quot;PT&quot;</span>,<span class="hljs-string">&quot;S&quot;</span>,  MOLAR_BASE_SI, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, pressure, temperature, [<span class="hljs-number">1.0</span>]) <span class="hljs-comment"># J/(kg·K)</span><br>    <span class="hljs-comment"># 检查是否有错误</span><br>    <span class="hljs-keyword">if</span> H_result.ierr == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> D_result.ierr == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> S_result.ierr == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;计算得到的H=:&quot;</span>,H_result.Output[<span class="hljs-number">0</span>])<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;计算得到的D=:&quot;</span>,D_result.Output[<span class="hljs-number">0</span>])<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;计算得到的S=:&quot;</span>,S_result.Output[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误: <span class="hljs-subst">&#123;H_result.herr&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># 路径</span><br>    os.environ[<span class="hljs-string">&#x27;RPPREFIX&#x27;</span>] = <span class="hljs-string">r&#x27;D:/REFPROP10&#x27;</span><br><br>    calculate_properties()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">将REFPROP封装为python库方便调用物性参数</summary>
    
    
    
    <category term="编程" scheme="http://example.com/categories/%E7%BC%96%E7%A8%8B/"/>
    
    <category term="Python" scheme="http://example.com/categories/%E7%BC%96%E7%A8%8B/Python/"/>
    
    
    <category term="Python" scheme="http://example.com/tags/Python/"/>
    
    <category term="编程" scheme="http://example.com/tags/%E7%BC%96%E7%A8%8B/"/>
    
    <category term="REFPROP" scheme="http://example.com/tags/REFPROP/"/>
    
  </entry>
  
</feed>
